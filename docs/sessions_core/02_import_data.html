<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<link rel="alternate" hreflang="en" href="/sessions_core/02_import_data.html" />
<link rel="alternate" hreflang="fr" href="/fr/sessions_core/02_import_data.fr.html" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-02-11">
<meta name="description" content="Create an Rstudio project, install useful packages and start importing data to work in R">
<title>Import data – {repicentre}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>
<script src="../site_libs/quarto-nav/quarto-nav.js"></script><script src="../site_libs/quarto-nav/headroom.min.js"></script><script src="../site_libs/clipboard/clipboard.min.js"></script><script src="../site_libs/quarto-search/autocomplete.umd.js"></script><script src="../site_libs/quarto-search/fuse.min.js"></script><script src="../site_libs/quarto-search/quarto-search.js"></script><meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script><script src="../site_libs/quarto-html/popper.min.js"></script><script src="../site_libs/quarto-html/tippy.umd.min.js"></script><script src="../site_libs/quarto-html/anchor.min.js"></script><link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0626ff4d7a71b55c8707dcae1d04a9b6.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-e25cc82807363e79c52e96bc8b7855f1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script><link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-b814d3e578892f16fb585af6f47f426f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-35dfec4a88a4a8552367c65e80eaa027.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../site_libs/font-awesome-6.5.2/js/script.js"></script><script type="text/javascript" src="../script.js"></script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">{repicentre}</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item"><div class="dropdown" id="languages-links-parent">
<button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="languages-button"><i class="bi bi-globe2"></i> English</button><ul class="dropdown-menu" id="languages-links"><li><a class="dropdown-item" href="/fr/sessions_core/02_import_data.html" id="language-link-fr">Français</a></li></ul>
</div></li>
<li class="nav-item">
    <a class="nav-link" href="../pathway.html"> 
<span class="menu-text">Pathway</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../explore.html"> 
<span class="menu-text">Explore</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li>
<a href="#setting-up-your-project" id="toc-setting-up-your-project" class="nav-link" data-scroll-target="#setting-up-your-project">Setting up your Project</a>
  <ul class="collapse">
<li><a href="#folder-structure" id="toc-folder-structure" class="nav-link" data-scroll-target="#folder-structure">Folder Structure</a></li>
  <li><a href="#sec-definitions" id="toc-sec-definitions" class="nav-link" data-scroll-target="#sec-definitions">Definitions</a></li>
  <li><a href="#rstudio-projects" id="toc-rstudio-projects" class="nav-link" data-scroll-target="#rstudio-projects">RStudio Projects</a></li>
  <li><a href="#rstudio-options" id="toc-rstudio-options" class="nav-link" data-scroll-target="#rstudio-options">RStudio Options</a></li>
  </ul>
</li>
  <li><a href="#creating-a-new-script" id="toc-creating-a-new-script" class="nav-link" data-scroll-target="#creating-a-new-script">Creating a New Script</a></li>
  <li>
<a href="#sec-packages" id="toc-sec-packages" class="nav-link" data-scroll-target="#sec-packages">Packages</a>
  <ul class="collapse">
<li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage">Usage</a></li>
  <li><a href="#updating-packages" id="toc-updating-packages" class="nav-link" data-scroll-target="#updating-packages">Updating Packages</a></li>
  </ul>
</li>
  <li>
<a href="#data-importation" id="toc-data-importation" class="nav-link" data-scroll-target="#data-importation">Data Importation</a>
  <ul class="collapse">
<li><a href="#sec-filepaths" id="toc-sec-filepaths" class="nav-link" data-scroll-target="#sec-filepaths">Understanding File Paths</a></li>
  <li><a href="#sec-import" id="toc-sec-import" class="nav-link" data-scroll-target="#sec-import">Import function</a></li>
  </ul>
</li>
  <li><a href="#taking-a-first-look-at-your-data" id="toc-taking-a-first-look-at-your-data" class="nav-link" data-scroll-target="#taking-a-first-look-at-your-data">Taking a First Look at your Data</a></li>
  <li><a href="#done" id="toc-done" class="nav-link" data-scroll-target="#done">Done!</a></li>
  <li>
<a href="#going-further" id="toc-going-further" class="nav-link" data-scroll-target="#going-further">Going Further</a>
  <ul class="collapse">
<li><a href="#extra-exercises" id="toc-extra-exercises" class="nav-link" data-scroll-target="#extra-exercises">Extra Exercises</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Import data</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Core</div>
    <div class="quarto-category">RStudio</div>
    <div class="quarto-category">Data Import</div>
  </div>
  </div>

<div>
  <div class="description">
    Create an Rstudio project, install useful packages and start importing data to work in R
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="objectives" class="level2"><h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Create a RStudio Project</li>
<li>Set up an organized and well documented code</li>
<li>Install and load packages</li>
<li>Write robust file paths<br>
</li>
<li>Import and inspect data</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The principles you learned in the <a href="01_introduction.html">Introduction to R</a> session will apply here as well: we should do our best to ensure that our projects won’t just work today but can also be reused and shared in the future. While doing this is not always easy, there are several best practices that can help us, and one of the most important is to start with a good, organized code base.</p>
</div>
</div>
</section><section id="setting-up-your-project" class="level2"><h2 class="anchored" data-anchor-id="setting-up-your-project">Setting up your Project</h2>
<section id="folder-structure" class="level3"><h3 class="anchored" data-anchor-id="folder-structure">Folder Structure</h3>
<div class="setup">
<p>If not done already, download and unzip the course folder. Save the uncompressed folder to a location that is <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="OneDrive doesn't play well with R as it will attempt to constantly synchronize certain project files in a way that can cause errors or memory problems"><strong>not connected to OneDrive</strong></span> and navigate into it.</p>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/raw/main/data/FETCHR.zip">
<button class="btn btn-default"><i class="fa fa-save"></i>  Course Folder</button>
</a>
</div>
</div>
</div>
<p>This folder gives an example of a typical (and highly recommended) structure for your code projects:</p>
<ul>
<li>📁 data
<ul>
<li>📁 clean</li>
<li>📁 raw</li>
</ul>
</li>
<li>📁 R</li>
<li>📁 outputs</li>
</ul>
<p>This folder will be you working directory for <strong>all the sessions of this course</strong>. You will create an Rstudio project in it (explanations below), and save all your scripts in <code>/R</code>. The course datasets are already in <code>data/raw</code>.</p>
</section><section id="sec-definitions" class="level3"><h3 class="anchored" data-anchor-id="sec-definitions">Definitions</h3>
<p>To work through this session you need to understand the two following concepts:</p>
<p><strong>Working directory.</strong> The working directory is the location (folder) where your R session is <em>actively working</em>. If you save a file, for example, it will be saved into this folder by default. Similarly, when you want to open a file, this folder will be shown by default. All relative paths will be relative to this working directory. By default, R usually picks the “Documents” folder as the working directory on Windows machines.</p>
<p><strong>Root.</strong> The root refers to the top-most folder level of the working directory. If your course folder was called <code>FETCHR</code>, the root would then be directly inside it (as opposed to being inside one of its subfolders like <code>R</code> or <code>Data</code>).</p>
</section><section id="rstudio-projects" class="level3"><h3 class="anchored" data-anchor-id="rstudio-projects">RStudio Projects</h3>
<p>An RStudio Project can be used to make your life easier and help orient <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Technically an RStudio Project is just a file containing some metadata that tells RStudio what files to open and where to set your working directory. It will spare you the headache of managing the working directory yourself.">RStudio around the various files used in your code</span></p>
<p>As a quick reminder, your interface should look something like this:</p>
<div id="fig-interface" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-interface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../img/core/01_introduction/01_rstudio_interface_en.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Screenshot of a typical Rstudio interface
</figcaption></figure>
</div>
<div class="setup">
<p>Open RStudio and create a new project by clicking <code>File &gt; New Project &gt; Existing Directory &gt; Browse</code>, navigating into (opening) the course folder, and clicking <code>Create Project</code>.</p>
</div>
<div class="look">
<p>In the Windows Explorer, look at the course folder. You should now see a new file with the extention <code>.Rproj</code> that has a small blue icon with an R in it.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/core/02_import/02_rproject.png" class="img-fluid figure-img"></p>
<figcaption>Icon associated with RStudio projects</figcaption></figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you don’t see this file, it’s probably because it is hidden by default on your computer. To change this setting in Windows Explorer, go into the <em>View</em> menu and select <code>Filename Extensions</code>.</p>
</div>
</div>
<p>When you open an RStudio Project, RStudio starts a new R session, opens the associated project files, and sets your working directory to the root of the course folder. At this time, RStudio also displays the subfolders of this directory in the panel on the bottom right.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is strongly recommended to set up a separate RStudio Project for each of your <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Here a single analysis would involve the full process of loading, cleaning, analyzing, and reporting on a dataset.">analyses</span> to ensure that your project files remain organized and manageable.</p>
</div>
</div>
<p>There are several ways to open an RStudio Project:</p>
<ul>
<li>Use the RStudio menu <code>File &gt; Open Project</code> and then select the relevant <code>.Rproj</code> file</li>
<li>Click on <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="You can also refer to this button at any time to see which project you are currently working in.">the <code>Project: (none)</code> button</span> on the top right of the RStudio interface</li>
<li>Navigate in the folder explorer to the analysis folder and double click on the file with the <code>.Rproj</code> extension</li>
</ul></section><section id="rstudio-options" class="level3"><h3 class="anchored" data-anchor-id="rstudio-options">RStudio Options</h3>
<p>Before continuing, let’s update some of RStudio’s problematic default settings:</p>
<div class="setup">
<p>Open the global options (<code>Tools &gt; Global Options</code>) and open the tab <code>General</code> (left menu). Make sure that <em>none</em> of the boxes in the sections <code>R Sessions</code>, <code>Workspace</code>, or <code>History</code> are checked.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/core/02_import/03_do_not_save.png" class="img-fluid figure-img"></p>
<figcaption>Screenshot of the Rstudio options</figcaption></figure>
</div>
<p>When checked, these options cause RStudio to save the objects in your environment and reload them as well as any files you previously had open when you open a new R session. While these default may seem like a good idea, it is better to always start your work from a fresh, <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="An empty session means the environment is empty, but you still have your scripts!">empty R session</span> to avoid bugs.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember that any commands or outputs that is needed for the cleaning and analysis should be saved explicitly in a script in the correct, functional order.</p>
</div>
</div>
</section></section><section id="creating-a-new-script" class="level2"><h2 class="anchored" data-anchor-id="creating-a-new-script">Creating a New Script</h2>
<div class="setup">
<p>Open a new script and save it in the <code>R</code> folder of your project under the name <code>import_data.R</code>.</p>
<p>Add some metadata to the top of the script as seen in the first session using <a href="../sessions_core/01_introduction.html#sec-comments">comments</a>. Be sure to include:</p>
<ul>
<li>Title</li>
<li>Author</li>
<li>Creation Date</li>
<li>Description</li>
</ul>
</div>
<p>Now you’re ready to start coding!</p>
</section><section id="sec-packages" class="level2"><h2 class="anchored" data-anchor-id="sec-packages">Packages</h2>
<p>Packages are collections of functions that extend the functionality of R. You’ll use them <strong>a lot</strong>, both in this course and in your daily life. Fortunately, as an open source language, R packages can be downloaded and installed for free from the internet.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R, packages are referenced using <code>{}</code>. For example <code>{ggplot2}</code> is the name of the ggplot2 package that contains new plotting functions such as <code>ggplot()</code>, <code>geom_point()</code> etc…</p>
</div>
</div>
<section id="installation" class="level3"><h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>We can install a new package using the function <code>install.packages()</code>, which downloads and installs it into the package library on your computer. This is done once per computer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"here"</span>) <span class="co"># install the {here} package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Don’t forget to wrap the package name in quotation marks when using <code>install.packages()</code>. What happens if you don’t do this?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are following this session as part of a course, to avoid any potential internet connectivity issues during the training we already had you install most of the course packages.</p>
<p>If are following this tutorial on your own or have not installed the packages yet, you will have to manually install each new package that we encounter.</p>
</div>
</div>
</section><section id="usage" class="level3"><h3 class="anchored" data-anchor-id="usage">Usage</h3>
<p>Once a package is installed we can use it but we have to specify to R that we will be using it <em>every single session</em>. This process is called <em>loading the package</em> and is achieved using the function <code>library()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># load the "here" package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="write">
<p>Use the <code>library()</code> function to load the packages <code>here</code> and <code>rio</code>, which will be used in the next section.</p>
</div>
<p>Based on your computer’s set up and the package you are trying to load, you may get a <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Unlike error messages, warnings will not cause R to stop an ongoing command. They are used to signal potential but not severe issues and do not always need to be fixed.">warning message</span> noting that some functions have been <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Masking occurs when R tries to load more than one function with the same name at the same time. This issue is surprisingly common, for example, there are a large number of packages that have a function called `filter()` or `select()`. When these conflicts occur, R will pick whichever version was loaded last and the other versions will be ignored (masked).">masked</span> or that the current version of the package was built for a different version of R. These messages are not usually a problem but are still important to note.</p>
<div class="write">
<p>Try to run the following code. Can you work out what the error means?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The above code throws an error because you have asked for a library that doesn’t exist. Remember that <strong>R is fickle and case sensitive</strong> and many of your errors will come from small typos in the names of functions or objects. Here, for example, we wanted to load the package <code>ggplot2</code> but wrote <code>ggplot</code> instead.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most of the time, you’ll need to load a number of packages for your script and it is recommended to have a section at the start of your code that loads everything you’ll need in one place:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages ----------------------------</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># data manipulation</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)   <span class="co"># date manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This practice makes it easy to tell which packages need to be installed to run a script.</p>
</div>
</div>
<div class="write">
<p>Use <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Remember that you can use the keyboard shortcuts CTRL+SHIFT+C and CTRL+SHIFT+R to insert comments and sections">comments</span> to create a “Packages” section to your script.</p>
</div>
</section><section id="updating-packages" class="level3"><h3 class="anchored" data-anchor-id="updating-packages">Updating Packages</h3>
<p>R has a very active community of developers and it’s pretty common for packages to be updated from time to time as their owners add in new functions and fix existing bugs. In order to update the packages in your library, you can go into the <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Remember that this tab shows a list of all the packages you have installed on your computer with their version numbers."><code>Packages</code> tab</span> of the bottom right panel and click <code>Update</code>. Don’t forget that you’ll <strong>need to be connected to the internet</strong> during this process.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes packages are updated in a way that might remove or change a function that you used in some of your scripts, causing your code to no longer work. <strong>Don’t panic</strong> if this happens. The best practice is to adapt <em>your code</em>, although in the worst case scenario you can <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="This is discouraged as it will make your code hard for others to use.">forcibly install an old version of a package</span>. This is however out of the scope of this session.</p>
</div>
</div>
</section></section><section id="data-importation" class="level2"><h2 class="anchored" data-anchor-id="data-importation">Data Importation</h2>
<section id="sec-filepaths" class="level3"><h3 class="anchored" data-anchor-id="sec-filepaths">Understanding File Paths</h3>
<p>To open a file in R you need to provide a <strong>file path</strong>. A file path is simply a longer name for a file, that includes not only its name but also its location on your computer. There are several ways of defining these paths, including <em>absolute</em> and <em>relative</em> paths.</p>
<section id="absolute-paths" class="level4"><h4 class="anchored" data-anchor-id="absolute-paths">Absolute Paths</h4>
<p>Absolute paths are <strong>specific to your computer</strong> and go all the way up to the level of your <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="For example, 'C:' or 'D:' on a Windows computer.">hard drive</span>. For example, an absolute path may look something like this: <code>D:/OneDrive - MSF/Documents/monitoring/cholera/fancy_project/data/raw/example_linelist.xlsx</code>. Clearly, this path will only work on one specific computer.</p>
<p>The use of <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="Hardcoded means that you wrote the full path in the script, the way it is given above, as opposed to building the paths by bits as we are going to show below.">hard coded</span> absolute paths is <strong>strongly discouraged</strong> as it makes your code inflexible and prone to break: the paths need to be updated every time your code is shared or the project folder is moved on your computer.</p>
</section><section id="relative-paths" class="level4"><h4 class="anchored" data-anchor-id="relative-paths">Relative Paths</h4>
<p>Relative paths are defined relatively to your current <a href="../sessions_core/02_import_data.html#sec-definitions">working directory</a>. For example, keeping in mind that our handy <code>.Rproj</code> file set our working directory to the root of our project folder, we could create a relative path that looked like <code>data/raw/example_linelist.xlsx</code>. This means that <strong>as long as we maintain the <em>internal</em> structure</strong> of our project folder and have an <code>.Rproj</code> file, our code would theoretically run on multiple computers.</p>
</section><section id="robust-paths-with-the-here-function" class="level4"><h4 class="anchored" data-anchor-id="robust-paths-with-the-here-function">Robust Paths with the <code>here()</code> function</h4>
<p>The <code>{here}</code> package has a <code>here()</code> function that really helps defining paths. It has two advantages:</p>
<ul>
<li>When used with RStudio projects, you can give it only the part of the path within the project, (the <em>relative path</em> in other words), and the function uses it to create the <em>absolute path</em> dynamically.</li>
<li>It does so using the separator adapted to you <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="For example, Windows, MacOS, Debian...">operating system</span>, whether it’s <code>/</code>, <code>\</code>, or <code>//</code>
</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"example_linelist.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/tmp/RtmpdrEKKI/fileb9ed7271132b4/data/raw/example_linelist.xlsx"</code></pre>
</div>
</div>
<p>See how we only defined the relative path and the function created an absolute path. This way of defining the path will work on your colleagues computer, even if they run on another operating system, as long as you both respect the internal structure of the working directory.</p>
<p>We <strong>strongly encourage you</strong> to use <code>here()</code> whenever you need to create a file path.</p>
<div class="write">
<p>Run the above code in the console. What file path does <code>here("data", "raw")</code> give <em>you</em>?</p>
</div>
<div class="write">
<p>Using <code>here()</code>, create a complete file path for the file <code>Moissalla-measles-linelist-EN.xlsx</code>. Keep this path around, we will use it soon.</p>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>here()</code> simply creates a file path, it doesn’t actually check if a file exists on your computer: if the file is absent or there is a typo in your code, the command will yield an error when the path is used. If you would like to use a function to check if a file exists, check out the <code>file.exists()</code> function.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>We will often want to source multiple data files in a single project. To make that process easier, it can be helpful to create a section at the start of the script, after loading the packages to define paths and store them in variables.</p>
</div>
</div>
</section></section><section id="sec-import" class="level3"><h3 class="anchored" data-anchor-id="sec-import">Import function</h3>
<p>In R different file formats are often imported using different, often specialized functions. This can be tedious as it requires you to memorize and load a large number of functions just to get your data imported. To avoid this problem, we recommend that you use the <code>import()</code> function from the package <span data-tooltip-position="top" data-tooltip="`rio` stands for R Inputs and Outputs."><code>{rio}</code></span>. This function is able to open a large variety of files (including Excel, csv, Stata, and many others) by recognizing the file extension of your data and <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="This type of function, providing an unified interface to other specific functions is known as a wrapper.">calling a relevant specialized function from another package</span> so that you don’t have to.</p>
<p>Because <code>import()</code> is actually just calling other functions in the background, it is possible that it will need different arguments depending on the type of file you want to load.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To see the full list of all the file types you can load (and save!) with <code>rio</code>, check out the list of <a href="https://gesistsa.github.io/rio/index.html#supported-file-formats">supported formats</a> on their website. In the rest of the lesson we will focus on importing data from Excel <code>.xlsx</code> files.</p>
</div>
</div>
<section id="importing-from-the-first-sheet" class="level4"><h4 class="anchored" data-anchor-id="importing-from-the-first-sheet">Importing from the First Sheet</h4>
<p>In general, the usage of <code>import()</code> is pretty simple, at minima you need to pass the path of the file to the <code>file</code> argument</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">import</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"example_linelist.xlsx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we have nested the command <code>here()</code> <strong>inside</strong> the <code>import()</code> command. Nesting functions is absolutely allowed in R and is something you will do <em>all the time</em>. When functions are nested, R will evaluate them in the order of the innermost function (in this case <code>here()</code>) to the outermost (in this case <code>import()</code>). In this way, the <em>output</em> of <code>here()</code> is being used as the <em>input</em> of <code>import()</code>.</p>
<div class="write">
<p>Import the file <code>Moissalla-measles-linelist-EN.xlsx</code> that is in your raw data subfolder into R using <code>here()</code> and <code>import()</code>.</p>
</div>
<p>If your import worked correctly, R will print the data into the console but not save it into the environment because we have not <a href="../sessions_core/01_introduction.html#sec-assignement-operator">assigned them to an object</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may not want to have R print very large datasets into the console and assign them directly to an object.</p>
</div>
</div>
<div class="write">
<p>Reimport your data but this time save it to an object called <code>df_linelist</code>.</p>
</div>
</section><section id="importing-data-from-any-sheet" class="level4"><h4 class="anchored" data-anchor-id="importing-data-from-any-sheet">Importing Data from Any Sheet</h4>
<p>As you just saw, R selects the first sheet by default. It is however possible to pass the number (or name) of a specific worksheet in your Excel data to <code>import()</code> using the argument <code>which</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">import</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"example_linelist.xlsx"</span>),</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">which =</span> <span class="dv">2</span>)  <span class="co"># imports the second sheet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the <code>which</code> argument is specific to the file types that have multiple sheets, such as Excel or .Rdata files. If you try to use it on a <code>.csv</code> file the argument will be ignored.</p>
</section></section></section><section id="taking-a-first-look-at-your-data" class="level2"><h2 class="anchored" data-anchor-id="taking-a-first-look-at-your-data">Taking a First Look at your Data</h2>
<p>We have now imported a dataset into R and assigned it to a dataframe (<code>df_linelist</code>). The natural next step is to inspect this dataset, to check that the import went well, get to know it a bit better, and assess if it requires any cleaning before analysis.</p>
<p>We can start by taking a quick look at the first few lines of the dataframe using the function <code>head()</code>. This function takes a dataframe as its first argument and optionally accepts a second argument <code>n</code> indicating the number of lines we would like to see.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_linelist, <span class="at">n =</span> <span class="dv">10</span>) <span class="co"># Inspect 10 first lines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="write">
<p>Use <code>head()</code> to examine the 12 first lines of <code>df_linelist</code>.</p>
</div>
<p>We can also check out our data by looking at the <em>Environment</em> tab of the top-right panel. Here, we can see our dataframe in the environment, look at its <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="This is the same as using the command `str()`">structure</span>, or open it in the data viewer of RStudio.</p>
<div class="look">
<p>Click on the round blue button next to <code>df_linelist</code> in your environment to see its structure. Then click on the name of the dataset to open it in the viewer.</p>
</div>
<p>The data viewer displays dataframes as tables and is a convenient way to quickly look at your data. You can even sort and filter your data in the “View”, though be aware that these actions will not make any changes to the actual object <code>df_linelist</code>. The View can also be opened by passing the dataframe to the function <code>View()</code>.</p>
</section><section id="done" class="level2"><h2 class="anchored" data-anchor-id="done">Done!</h2>
<p>Well done and don’t forget to save your code.</p>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/blob/main/sessions_core/02_import_data_solutions.R">
<button class="btn btn-default"><i class="fa fa-save"></i> Solution File</button>
</a>
</div>
</div>
</section><section id="going-further" class="level2"><h2 class="anchored" data-anchor-id="going-further">Going Further</h2>
<section id="extra-exercises" class="level3"><h3 class="anchored" data-anchor-id="extra-exercises">Extra Exercises</h3>
<ol type="1">
<li>Use <code>dim()</code> to take a look at the dimensions of your dataset.</li>
<li>Use <code>str()</code> to check the data type of each column. Does anything look odd? Remember that you can also use functions like <code>is.character()</code> and <code>is.numeric()</code> if you’d like to test the type of a particular column.</li>
<li>Using a function learned in the first session, can you extract the names of the columns of the dataset? Do these results match what you see when you open the data in Excel?</li>
<li>Try passing your dataframe to the function <code>summary()</code>. What does this function tell you?</li>
</ol></section><section id="additional-resources" class="level3"><h3 class="anchored" data-anchor-id="additional-resources">Additional Resources</h3>
<ul>
<li>The <code>{rio}</code> <a href="https://gesistsa.github.io/rio/index.html#supported-file-formats">website</a>
</li>
<li>
<a href="https://epirhandbook.com/en/new_pages/importing.html">More examples</a> on importing data of various file types</li>
</ul></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body>
</html>
