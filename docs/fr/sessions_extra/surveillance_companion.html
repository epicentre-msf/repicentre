<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<link rel="alternate" hreflang="en" href="/sessions_extra/surveillance_companion.html" />
<link rel="alternate" hreflang="fr" href="/fr/sessions_extra/surveillance_companion.fr.html" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Tutoriel d‚Äôaccompagnement au module Surveillance du FETCH">
<title>Surveillance ‚Äì {repicentre}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>
<script src="../site_libs/quarto-nav/quarto-nav.js"></script><script src="../site_libs/quarto-nav/headroom.min.js"></script><script src="../site_libs/clipboard/clipboard.min.js"></script><script src="../site_libs/quarto-search/autocomplete.umd.js"></script><script src="../site_libs/quarto-search/fuse.min.js"></script><script src="../site_libs/quarto-search/quarto-search.js"></script><meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script><script src="../site_libs/quarto-html/popper.min.js"></script><script src="../site_libs/quarto-html/tippy.umd.min.js"></script><script src="../site_libs/quarto-html/anchor.min.js"></script><link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-9a023c9ade86a60361e96e3e3f11bc54.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script><link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6ab5e0891aed6e954066009cd4eecacc.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-b92d258d3900ea06ce3f9b55f30b4460.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de r√©sultats",
    "search-matching-documents-text": "documents trouv√©s",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script><script src="../site_libs/font-awesome-6.5.2/js/script.js"></script><script type="text/javascript" src="../script.js"></script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">{repicentre}</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item"><div class="dropdown" id="languages-links-parent">
<button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="languages-button"><i class="bi bi-globe2"></i> Fran√ßais</button><ul class="dropdown-menu" id="languages-links"><li><a class="dropdown-item" href="/sessions_extra/surveillance_companion.html" id="language-link-en">English</a></li></ul>
</div></li>
<li class="nav-item">
    <a class="nav-link" href="../pathway.html"> 
<span class="menu-text">Cours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../explore.html"> 
<span class="menu-text">Explorer</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Ressources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">√Ä Propos</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Basculer le mode sombre"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Sur cette page</h2>
   
  <ul>
<li><a href="#objectifs" id="toc-objectifs" class="nav-link active" data-scroll-target="#objectifs">Objectifs</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li>
<a href="#mise-en-place-question-2" id="toc-mise-en-place-question-2" class="nav-link" data-scroll-target="#mise-en-place-question-2">Mise en place (Question 2)</a>
  <ul class="collapse">
<li><a href="#cr%C3%A9er-le-projet" id="toc-cr√©er-le-projet" class="nav-link" data-scroll-target="#cr√©er-le-projet">Cr√©er le projet</a></li>
  <li><a href="#importer-les-donn%C3%A9es" id="toc-importer-les-donn√©es" class="nav-link" data-scroll-target="#importer-les-donn√©es">Importer les donn√©es</a></li>
  </ul>
</li>
  <li>
<a href="#nettoyage-question-2-and-3" id="toc-nettoyage-question-2-and-3" class="nav-link" data-scroll-target="#nettoyage-question-2-and-3">Nettoyage (Question 2 and 3)</a>
  <ul class="collapse">
<li><a href="#donn%C3%A9es-de-surveillance-q2" id="toc-donn√©es-de-surveillance-q2" class="nav-link" data-scroll-target="#donn√©es-de-surveillance-q2">Donn√©es de surveillance (Q2)</a></li>
  <li><a href="#donn%C3%A9es-labo-q2" id="toc-donn√©es-labo-q2" class="nav-link" data-scroll-target="#donn√©es-labo-q2">Donn√©es labo (Q2)</a></li>
  <li><a href="#aller-plus-loin" id="toc-aller-plus-loin" class="nav-link" data-scroll-target="#aller-plus-loin">Aller plus loin</a></li>
  <li><a href="#donn%C3%A9es-de-surveillance-compl%C3%A9t%C3%A9es-q3" id="toc-donn√©es-de-surveillance-compl√©t√©es-q3" class="nav-link" data-scroll-target="#donn√©es-de-surveillance-compl√©t√©es-q3">Donn√©es de surveillance compl√©t√©es (Q3)</a></li>
  <li><a href="#aller-plus-loin-1" id="toc-aller-plus-loin-1" class="nav-link" data-scroll-target="#aller-plus-loin-1">Aller plus loin</a></li>
  </ul>
</li>
  <li>
<a href="#d%C3%A9finir-les-alertes-question-4" id="toc-d√©finir-les-alertes-question-4" class="nav-link" data-scroll-target="#d√©finir-les-alertes-question-4">D√©finir les alertes (Question 4)</a>
  <ul class="collapse">
<li><a href="#pr%C3%A9parer-le-jeu-de-donn%C3%A9es" id="toc-pr√©parer-le-jeu-de-donn√©es" class="nav-link" data-scroll-target="#pr√©parer-le-jeu-de-donn√©es">Pr√©parer le jeu de donn√©es</a></li>
  <li><a href="#zones-de-sant%C3%A9-en-alerte" id="toc-zones-de-sant√©-en-alerte" class="nav-link" data-scroll-target="#zones-de-sant√©-en-alerte">Zones de sant√© en alerte</a></li>
  </ul>
</li>
  <li><a href="#tracer-la-courbe-%C3%A9pid%C3%A9mique-question-4" id="toc-tracer-la-courbe-√©pid√©mique-question-4" class="nav-link" data-scroll-target="#tracer-la-courbe-√©pid√©mique-question-4">Tracer la courbe √©pid√©mique (Question 4)</a></li>
  <li>
<a href="#indicateurs-cl%C3%A9s-question-6" id="toc-indicateurs-cl√©s-question-6" class="nav-link" data-scroll-target="#indicateurs-cl√©s-question-6">Indicateurs cl√©s (Question 6)</a>
  <ul class="collapse">
<li><a href="#premi%C3%A8re-semaine-en-alerte" id="toc-premi√®re-semaine-en-alerte" class="nav-link" data-scroll-target="#premi√®re-semaine-en-alerte">Premi√®re semaine en alerte</a></li>
  <li><a href="#indicateurs-des-donn%C3%A9es-de-surveillance" id="toc-indicateurs-des-donn√©es-de-surveillance" class="nav-link" data-scroll-target="#indicateurs-des-donn√©es-de-surveillance">Indicateurs des donn√©es de surveillance</a></li>
  <li><a href="#indicateurs-des-donn%C3%A9es-labo" id="toc-indicateurs-des-donn√©es-labo" class="nav-link" data-scroll-target="#indicateurs-des-donn√©es-labo">Indicateurs des donn√©es labo</a></li>
  </ul>
</li>
  <li><a href="#cest-fini" id="toc-cest-fini" class="nav-link" data-scroll-target="#cest-fini">C‚Äôest fini !</a></li>
  <li>
<a href="#sec-going-further" id="toc-sec-going-further" class="nav-link" data-scroll-target="#sec-going-further">Aller plus loin</a>
  <ul class="collapse">
<li><a href="#explications-sur-complete" id="toc-explications-sur-complete" class="nav-link" data-scroll-target="#explications-sur-complete">Explications sur <code>complete()</code></a></li>
  <li><a href="#explications-sur-rollaply" id="toc-explications-sur-rollaply" class="nav-link" data-scroll-target="#explications-sur-rollaply">Explications sur <code>rollaply()</code></a></li>
  <li><a href="#formatage-des-pourcentages" id="toc-formatage-des-pourcentages" class="nav-link" data-scroll-target="#formatage-des-pourcentages">Formatage des pourcentages</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Surveillance</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Satellite</div>
    <div class="quarto-category">Surveillance</div>
  </div>
  </div>

<div>
  <div class="description">
    Tutoriel d‚Äôaccompagnement au module Surveillance du FETCH
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="objectifs" class="level2"><h2 class="anchored" data-anchor-id="objectifs">Objectifs</h2>
<ul>
<li>Travailler les comp√©tences acquises dans les deux modules FETCH-R (importation, nettoyage et visualisation des donn√©es).</li>
<li>Analyser des donn√©es de surveillance rougeole pour d√©tecter les alertes et aider √† prioriser quelles alertes doivent √™tre approfondies avec une enqu√™te sur le terrain.</li>
</ul></section><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Ce satellite accompagne l‚Äô√©tude de cas <em>R√©ponse d‚Äôurgence contre la rougeole dans la r√©gion du Katanga (RDC)</em> du module FETCH Surveillance. √áa n‚Äôa probablement pas beaucoup de sens d‚Äôessayer de le suivre sans les documents et les discussions de l‚Äô√©tude.</p>
<p>En ce qui concerne la partie <em>R</em> du module surveillance, nous nous appuierons sur les comp√©tences acquises tout au long des modules FETCH-R, et introduirons quelques nouvelles fonctions utiles pour le nettoyage et les analyses.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>N‚Äôh√©sitez pas √† checker vos notes, vos scripts ou les tutoriels des sessions pr√©c√©dentes pour vous rafra√Æchir sur le fonctionnement de certaines fonctions quand vous en √©prouvez le besoin.</p>
</div>
</div>
</section><section id="mise-en-place-question-2" class="level2"><h2 class="anchored" data-anchor-id="mise-en-place-question-2">Mise en place (Question 2)</h2>
<p>Comme cette session fait partie d‚Äôun module sp√©cifique, vous allez cr√©er un nouveau projet RStudio. Jetez un coup d‚Äô≈ìil <a href="../sessions_core/02_import_data.html">√† la session principale</a> si vous ne vous rappelez plus comment faire.</p>
<section id="cr√©er-le-projet" class="level3"><h3 class="anchored" data-anchor-id="cr√©er-le-projet">Cr√©er le projet</h3>
<div class="setup">
<ol type="1">
<li>Cr√©ez un dossier <code>surveillance_case_study</code> sur votre ordinateur, associ√© avec le module Surveillance du FETCH. Ajoutez les sous dossiers suivants √† l‚Äôint√©rieur :</li>
</ol>
<ul>
<li>üìÅ data
<ul>
<li>üìÅ clean</li>
<li>üìÅ raw</li>
</ul>
</li>
<li>üìÅ R</li>
<li>üìÅ outputs</li>
</ul>
<ol start="2" type="1">
<li><p>Cr√©ez un <a href="../sessions_core/02_import_data.html#rstudio-projects">projet RStudio</a> √† la racine du dossier <code>surveillance_case_study</code>.</p></li>
<li><p>Si vous n‚Äôavez pas encore les donn√©es, t√©l√©chargez-les.</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/raw/main/data/surveillance_module/raw/donnes_brutes_fr.zip">
<button class="btn btn-default"><i class="fa fa-save"></i> T√©l√©charger les donn√©es brutes</button>
</a>
</div>
</div>
<p><br> 4. D√©zippez l‚Äôarchive si vous venez de t√©l√©charger les donn√©es. Quelle que soit la source, enregistrez les deux fichiers Excel dans le sous dossier <code>data/raw</code>. <br> 5. Cr√©ez un nouveau script <code>import_nettoyage.R</code> et enregistrez-le dans le sous dossier <code>R</code>. Ajoutez les m√©tadonn√©es et une section pour charger les paquets <code>{here}</code>, <code>{rio}</code>, et <code>{tidyverse}</code>.</p>
</div>
</section><section id="importer-les-donn√©es" class="level3"><h3 class="anchored" data-anchor-id="importer-les-donn√©es">Importer les donn√©es</h3>
<p><strong>Rappel de l‚Äô√©tude de cas</strong> : vous avez demand√© l‚Äôacc√®s aux donn√©es de surveillance de routine et aux donn√©es de laboratoire au MSP de la RDC. Le minist√®re a accept√© de les partager avec vous toutes les semaines. Vous recevez le premier fichier √† la semaine 20 en 2022 (note : les donn√©es sur lesquelles nous travaillerons sont simul√©es).</p>
<div class="look">
<p>Si vous ne l‚Äôavez pas d√©j√† fait, ouvrez les deux fichiers dans un tableur (Excel ou autre) pour les inspecter avant l‚Äôimportation.</p>
</div>
<p>Le jeu de donn√©es de surveillance a l‚Äôair facile √† importer. En revanche, le jeu de donn√©es laboratoire pourrait vous inqui√©ter, avec ses lignes suppl√©mentaires avant les donn√©es‚Ä¶ Heureusement, la fonction <code>import()</code> que nous utilisons a un argument <code>skip</code> qui permet de g√©rer ce cas courant :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NE PAS EX√âCUTER (PSEUDO-CODE)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">import</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"fichier_exemple.xlsx"</span>), </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">3</span>  <span class="co"># Sauter les trois premi√®res lignes, l'import commence √† la ligne 4</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="write">
<ol type="1">
<li><p>Ajoutez une section pour l‚Äôimport des donn√©es √† votre script.</p></li>
<li><p>Importez le jeu de donn√©es surveillance et stockez le dans un objet <code>df_surv_brut</code>. Ensuite, importez le jeu de donn√©es laboratoire et stockez le dans un objet <code>df_labo_brut</code>.</p></li>
<li><p>V√©rifiez que l‚Äôimportation s‚Äôest bien pass√©e pour les deux data frames (vous avez plusieurs outils √† votre disposition : Viewer, dimensions de l‚Äôobjet, haut et bas du data frame‚Ä¶).</p></li>
</ol>
</div>
</section></section><section id="nettoyage-question-2-and-3" class="level2"><h2 class="anchored" data-anchor-id="nettoyage-question-2-and-3">Nettoyage (Question 2 and 3)</h2>
<p>Maintenant que les donn√©es sont import√©es, nous pouvons effectuer quelques v√©rifications dessus, et les nettoyer.</p>
<section id="donn√©es-de-surveillance-q2" class="level3"><h3 class="anchored" data-anchor-id="donn√©es-de-surveillance-q2">Donn√©es de surveillance (Q2)</h3>
<section id="inspection-rapide" class="level4"><h4 class="anchored" data-anchor-id="inspection-rapide">Inspection rapide</h4>
<p>Pendant l‚Äô√©tude de cas vous n‚Äôaurez peut-√™tre pas le temps d‚Äôinspecter <em>et</em> nettoyer <em>toutes</em> les colonnes. Nous vous proposons donc de vous focaliser sur quelques colonnes cl√©s : <code>zone_sante</code>, <code>semaine</code>, <code>totalcas</code> et <code>totaldeces</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si vous revenez sur le tutoriel plus tard ou finissez en avance, n‚Äôh√©sitez pas √† v√©rifier la qualit√© des autres variables, et √† recouper les informations de diff√©rentes colonnes. Nous vous renvoyons √† la discussion lors de l‚Äô√©tude ou aux documents du module de gestion des donn√©es pour des id√©es de v√©rifications √† effectuer.</p>
</div>
</div>
<div class="write">
<p>Ajoutez une section pour l‚Äôexploration et le nettoyage des donn√©es de surveillance dans votre script. <br> Maintenant, explorez le data frame et r√©pondez aux questions suivantes :</p>
<ul>
<li>Quels sont les noms des colonnes ?</li>
<li>Combien de provinces y a-t-il dans le jeu de donn√©es actuel ? Cela correspond-il √† ce que vous attendez ?</li>
<li>Combien de zones de sant√© y a-t-il dans le jeu de donn√©es ? Cela correspond-il √† ce que vous attendez ?</li>
<li>Quel est la plage des semaines ?</li>
<li>Quelle est la valeur minimale de <code>totalcas</code> ?</li>
<li>Quel est le maximum de <code>totaldeces</code> ?</li>
<li>Remarquez-vous des donn√©es manquantes pour les colonnes ci-dessus ? Les cha√Ænes de caract√®re (rappel : le texte) sont-elles propres ?</li>
</ul>
</div>
</section><section id="nettoyer-les-cha√Ænes-de-caract√®res" class="level4"><h4 class="anchored" data-anchor-id="nettoyer-les-cha√Ænes-de-caract√®res">Nettoyer les cha√Ænes de caract√®res</h4>
<p>Maintenant que nous avons une meilleure id√©e de l‚Äô√©tat des donn√©es, nettoyons-les. Nous allons √©crire un <em>pipeline de nettoyage</em> (ou <em>cha√Æne de commandes</em>) comme dans les modules R pr√©c√©dents (voir votre code √† la fin du <a href="../sessions_core/04_data_verbs_conditional.html">module de nettoyage</a>).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour faciliter le d√©bogage de la cha√Æne de commandes, <strong>ajoutez et testez les √©tapes unes par unes</strong> !</p>
</div>
</div>
<p>Nous allons am√©liorer un peu les colonnes de texte afin d‚Äô√©liminer des probl√®mes potentiels :</p>
<ul>
<li>passer tout en minuscules (homog√©n√©ise)</li>
<li>supprimer les espaces surnum√©raires (√©ventuels)</li>
<li>remplacer <code>-</code> et les espaces par <code>_</code>.</li>
</ul>
<p>Peut √™tre que vous n‚Äôaurez pas le temps de faire ces √©tapes pour toutes les colonnes. Pour commencer, choisissez une de ces deux colonnes : <code>zone_sante</code> ou <code>prov</code> pour appliquer les instructions. Vous pourrez faire les autres plus tard.</p>
<div class="write">
<p>Commencez un <em>pipeline</em> de nettoyage avec un <code>mutate()</code> pour transformer la colonne de votre choix en minuscules.</p>
</div>
<p>Nous allons maintenant voir deux petites fonctions tr√®s utiles pour le nettoyage du texte. La premi√®re est la fonction <code>str_squish()</code> du paquet <code>{stringr}</code> (<a href="https://stringr.tidyverse.org/reference/str_trim.html">la page d‚Äôaide</a>), qui supprime les espaces au d√©but ou √† la fin des cha√Ænes de caract√®res, et les espaces surnum√©raires ou qu‚Äôils soient :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>exemples <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">" Espaces au d√©but et √† la fin     "</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Espaces     multiples"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">" Tous les     probl√®mes  "</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_squish</span>(exemples)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Espaces au d√©but et √† la fin" "Espaces multiples"           
[3] "Tous les probl√®mes"          </code></pre>
</div>
</div>
<p>L‚Äôautre fonction, <code>str_replace</code> (√©galement du <a href="https://stringr.tidyverse.org/reference/str_replace.html?q=str_replace#null">paquet <code>{stringr}</code></a>) remplace un bout de texte dans une cha√Æne de caract√®res par un autre bout de texte, sans surprise. L‚Äôargument <code>pattern</code> accepte le texte √† remplacer, et l‚Äôargument <code>replacement</code> le texte √† utiliser comme remplacement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HAUT-KATANGA"</span>,    <span class="co"># Le texte sur lequel on travaille (peut √™tre une colonne)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"-"</span>,     <span class="co"># Le bout √† remplacer</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"_"</span>  <span class="co"># Le remplacement</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "HAUT_KATANGA"</code></pre>
</div>
</div>
<div class="write">
<p>Ajoutez des lignes √† votre mutate pour, sur la colonne de votre choix :</p>
<ul>
<li>Nettoyer les espaces</li>
<li>Changer les <code>-</code> et les espaces en <code>_</code> (deux √©tapes)</li>
</ul>
<p>Le d√©but d‚Äôau moins une des colonnes devrait ressembler √† :</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  pays     province     zone_sante  maladie
1  rdc haut_katanga mufunga_sampwe rougeole
2  rdc haut_katanga        sakania rougeole
3  rdc haut_katanga        mitwaba rougeole
4  rdc haut_katanga kilela_balanda rougeole
5  rdc haut_katanga         likasi rougeole
6  rdc haut_katanga         kikula rougeole</code></pre>
</div>
</div>
<p>Stockez le r√©sultat dans un data frame <code>df_surv</code>.</p>
</div>
</section><section id="enregistrer-les-donn√©es-nettoy√©es" class="level4"><h4 class="anchored" data-anchor-id="enregistrer-les-donn√©es-nettoy√©es">Enregistrer les donn√©es nettoy√©es</h4>
<div class="write">
<p>Utilisez le paquet <code>{rio}</code> pour exporter <code>df_surv</code> vers un fichier <code>.rds</code> appel√© <code>data_ids_2022-20_clean</code> dans le sous dossier <code>data/clean</code> de votre projet.</p>
</div>
</section></section><section id="donn√©es-labo-q2" class="level3"><h3 class="anchored" data-anchor-id="donn√©es-labo-q2">Donn√©es labo (Q2)</h3>
<p>Nous allons suivre les m√™mes √©tapes pour le jeu de donn√©es laboratoire. Nous nous focaliserons sur les colonnes <code>zone_sante</code>, <code>igm_rougeole</code> et <code>igm_rubeole</code>.</p>
<section id="inspection-rapide-1" class="level4"><h4 class="anchored" data-anchor-id="inspection-rapide-1">Inspection rapide</h4>
<div class="write">
<p>Inspectez les colonnes mentionn√©es, et les dimensions du data frame.</p>
<p>Quelles sont les cat√©gories des colonnes <code>igm_rougeole</code> et <code>igm_rubeole</code> ? Quel type de nettoyage sera √† effectuer dessus ?</p>
</div>
</section><section id="nettoyage-et-recodage" class="level4"><h4 class="anchored" data-anchor-id="nettoyage-et-recodage">Nettoyage et recodage</h4>
<div class="write">
<ol type="1">
<li><p>D√©marrez un nouveau <em>pipeline</em> de nettoyage pour les donn√©es labo. Choisissez une colonne de texte et passez l√† en minuscules, puis supprimez les espaces surnum√©raires. Enfin, remplacez les espaces et les <code>-</code> par <code>_</code>.</p></li>
<li><p>Recodez au moins une des colonnes <code>igm_rougeole</code> ou <code>igm_rubeole</code> pour que les cat√©gories soient <code>negatif</code>, <code>positif</code> et <code>indetermin√©</code>.</p></li>
<li><p>Stockez la version nettoy√©e dans un data frame <code>df_labo</code></p></li>
</ol>
<p>L‚Äôen-t√™te des colonnes nettoy√©es devrait maintenant √™tre :</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   zone_sante igm_rougeole igm_rubeole
1     kambove      negatif     negatif
2     kambove      negatif     negatif
3     kambove      negatif     positif
4     kambove      negatif     negatif
5     kambove      negatif     positif
6     kambove      negatif     negatif
7     kambove      negatif     negatif
8     kambove      negatif     positif
9      manika      negatif     negatif
10  kamalondo      negatif     negatif</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Vous pouvez utiliser la fonction <code>case_when()</code> pour recoder les colonnes contenant les r√©sultats des tests anticorps.</p>
</div>
</div>
</div>
</section><section id="enregistrer-les-donn√©es-nettoy√©es-1" class="level4"><h4 class="anchored" data-anchor-id="enregistrer-les-donn√©es-nettoy√©es-1">Enregistrer les donn√©es nettoy√©es</h4>
<div class="write">
<p>Exportez le data frame <code>df_labo</code> vers un fichier <code>.rds</code> appel√© <code>df_labo_2022-w20_clean</code> dans le sous dossier <code>data/clean</code> de votre projet.</p>
</div>
</section></section><section id="aller-plus-loin" class="level3"><h3 class="anchored" data-anchor-id="aller-plus-loin">Aller plus loin</h3>
<p>Vous √™tes arriv√©s au bout de la question 2. Si vous avez termin√© en avance, utilisez les fonctions vues pour nettoyer les autres colonnes de texte dans les deux data frames, et recodez les deux colonnes IGM dans les donn√©es labo.</p>
<p>Si vous avez encore du temps, inspectez vos donn√©es plus avant :</p>
<ul>
<li>Affichez la zone de sant√© pour laquelle les totaux par groupe d‚Äô√¢ge sont diff√©rents de la colonne total (pour les cas, puis pour les d√©c√®s)</li>
<li>Est-ce qu‚Äôil y a une ZS o√π le nombre de d√©c√®s est plus √©lev√© que le nombre de cas ?</li>
<li>Y a-t-il des lignes dupliqu√©es (enti√®rement dupliqu√©es, ou plusieurs valeurs pour la zone de sant√© et la semaine) ?</li>
<li>Y a-t-il des nombres de cas que vous estimez aberrants ?</li>
</ul></section><section id="donn√©es-de-surveillance-compl√©t√©es-q3" class="level3"><h3 class="anchored" data-anchor-id="donn√©es-de-surveillance-compl√©t√©es-q3">Donn√©es de surveillance compl√©t√©es (Q3)</h3>
<p>Durant l‚Äôinspection des donn√©es vous avez du vous rendre compte qu‚Äôil y a des semaines manquantes pour certaines ZS dans les donn√©es de surveillance. Normalement, vous avez discut√© les raisons possibles et des probl√®mes associ√©s en pl√©ni√®re. Dans ce tutoriel, nous allons fournir le code pour compl√©ter le data frame surveillance pour que toutes les ZS aient toutes les semaines (en faisant l‚Äôhypoth√®se que les semaines manquantes n‚Äôont pas eu de cas ou de d√©c√®s).</p>
<p>Nous utiliserons la fonction <a href="https://tidyr.tidyverse.org/reference/complete.html"><code>complete()</code> du paquet <code>{tidyr}</code></a> pour ajouter les lignes manquantes et remplir les colonnes contenant des nombres (<code>totalcas</code> et <code>totaldeces</code>) avec des z√©ros. A cause des contraintes de temps nous allons vous donner le code, mais quelques exemples et explications seront donn√©s dans la section <a href="#sec-going-further">Aller plus loin</a>, que vous pourrez lire quand vous aurez le temps.</p>
<div class="write">
<ol type="1">
<li><p>Commencez un nouveau pipeline √† partir de <code>df_surv</code> et ne conservez dedans que les colonnes <code>province</code>, <code>zone_sante</code>, <code>semaine</code> et <code>totalcas</code>.</p></li>
<li><p>Ajoutez une nouvelle √©tape √† votre pipeline et collez le code ci-dessous pour compl√©ter le data frame :</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On travaille sur les combinaisons existantes de province et ZS</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nesting</span>(province, zone_sante),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On voudra toutes les semaines entre le minimum (1) et le maximum (20) de la colonne semaine</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">semaine =</span> <span class="fu">seq</span>(<span class="fu">min</span>(semaine, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">max</span>(semaine, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remplir les nouvelles semaines de zeros pour ces colonnes :</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">totalcas   =</span> <span class="dv">0</span>, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">totaldeces =</span> <span class="dv">0</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Stockez le r√©sultat dans un data frame appel√© <code>df_surv_sem</code>, qui devrait ressembler √† :</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 5
   province     zone_sante semaine totalcas totaldeces
   &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 haut_katanga kafubu           1        0          0
 2 haut_katanga kafubu           2        0          0
 3 haut_katanga kafubu           3        0          0
 4 haut_katanga kafubu           4        0          0
 5 haut_katanga kafubu           5        0          0
 6 haut_katanga kafubu           6        0          0
 7 haut_katanga kafubu           7        0          0
 8 haut_katanga kafubu           8        0          0
 9 haut_katanga kafubu           9        0          0
10 haut_katanga kafubu          10        0          0</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>exportez ce data frame dans un fichier <code>.rds</code> appel√© <code>data_ids_2022-w20_weeks_clean</code> dans le sous dossier <code>data/clean</code> de votre projet.</li>
</ol>
</div>
</section><section id="aller-plus-loin-1" class="level3"><h3 class="anchored" data-anchor-id="aller-plus-loin-1">Aller plus loin</h3>
<p>C‚Äôest la fin de la question 3. Si vous terminez en avance, finissez l‚Äôinspection des donn√©es, listez les probl√®mes et nettoyez les colonnes que vous savez nettoyer avant de r√©exporter. Si c‚Äôest fait, lisez les eplications sur la fonction <code>complete()</code> et allez explorer sa <a href="https://tidyr.tidyverse.org/reference/complete.html">page d‚Äôaide</a>.</p>
</section></section><section id="d√©finir-les-alertes-question-4" class="level2"><h2 class="anchored" data-anchor-id="d√©finir-les-alertes-question-4">D√©finir les alertes (Question 4)</h2>
<section id="pr√©parer-le-jeu-de-donn√©es" class="level3"><h3 class="anchored" data-anchor-id="pr√©parer-le-jeu-de-donn√©es">Pr√©parer le jeu de donn√©es</h3>
<p>Nous allons continuer la pr√©paration de data frames pr√™ts pour l‚Äôanalyse.</p>
<div class="setup">
<ol type="1">
<li>Si vous n‚Äôavez pas eu le temps de nettoyer la zone de sant√© et la province dans les deux data frames, et les deux colonnes IGM dans le jeu de donn√©es labo, vous pouvez importer les jeux de donn√©es nettoy√©s :</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/raw/main/data/surveillance_module/clean/clean_data_fr.zip">
<button class="btn btn-default"><i class="fa fa-save"></i> T√©l√©charger donn√©es propres</button>
</a>
</div>
</div>
<p><br> D√©zippez l‚Äôarchive et importez les donn√©es dans le sous dossier <code>data/clean</code></p>
<ol start="2" type="1">
<li><p>Cr√©ez un script <code>analyse_surveillance.R</code> dans le sous dossier <code>R</code>. Ajoutez les m√©tadonn√©es, et une section pour importer les paquets <code>{here}</code>, <code>{rio}</code>, <code>{tidyverse}</code>, <code>{lubridate}</code> et <code>{zoo}</code>.</p></li>
<li><p>Ajoutez une section d‚Äôimport des donn√©es propres et importez les fichiers <code>.rds</code> dans R en utilisant la fonction <code>import()</code> comme d‚Äôhabitude (soit les v√¥tres, soit ceux que vous venez de t√©l√©charger). Assignez ces donn√©es nettoy√©es aux data frames <code>df_surv</code>, <code>df_labo</code> and <code>df_surv_sem</code>.</p></li>
</ol>
</div>
<section id="s√©lection-des-zs" class="level4"><h4 class="anchored" data-anchor-id="s√©lection-des-zs">S√©lection des ZS</h4>
<p>Pour simplifier le travail nous allons nous focaliser sur quatre zones de sant√© : Dilolo, Kampemba, Kowe, et Lwamba.</p>
<div class="write">
<p>Commencez une nouvelle cha√Æne de commande √† partir du data frame <code>df_surv_sem</code>. La premi√®re √©tape est de filtrer les donn√©es pour ne conserver que les zones de sant√© Dilolo, Kampemba, Kowe, et Lwamba.</p>
</div>
</section><section id="indicateur-hebdomadaire" class="level4"><h4 class="anchored" data-anchor-id="indicateur-hebdomadaire">Indicateur hebdomadaire</h4>
<p>Notre premier indicateur regarde si <em>une zone de sant√© a 20 cas suspects ou plus dans une semaine</em>. Cet indicateur est dichotomique et ne prend en compte que les donn√©es d‚Äôune zone de sant√© pour une semaine donn√©e (√ßa tombe bien, √ßa correspond aux lignes du data frame).</p>
<div class="write">
<p>Ajoutez un <code>mutate()</code> √† votre cha√Æne pour cr√©er une colonne <code>cas20</code> qui contient la valeur <code>1</code> si une ZS a 20 cas ou plus cette semaine-l√†, et <code>0</code> sinon.</p>
<p><br> Le d√©but du data frame ressemble √† √ßa :</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 6
   province     zone_sante semaine totalcas totaldeces cas20
   &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 haut_katanga kampemba         1       75          0     1
 2 haut_katanga kampemba         2       42          0     1
 3 haut_katanga kampemba         3       46          0     1
 4 haut_katanga kampemba         4       50          0     1
 5 haut_katanga kampemba         5       43          0     1
 6 haut_katanga kampemba         6       33          0     1
 7 haut_katanga kampemba         7       45          0     1
 8 haut_katanga kampemba         8       52          0     1
 9 haut_katanga kampemba         9       38          0     1
10 haut_katanga kampemba        10       46          0     1</code></pre>
</div>
</div>
</div>
</section><section id="indicateur-cumul√©" class="level4"><h4 class="anchored" data-anchor-id="indicateur-cumul√©">Indicateur cumul√©</h4>
<p>Notre second indicateur regarde si une zone de sant√© compte plus de 35 <em>cas suspects cumul√©s en trois semaines</em>. C‚Äôest un peu plus compliqu√© √† calculer que l‚Äôindicateur hebdomadaire : pour chaque zone de sant√©, il faut calculer la somme des cas par fen√™tres de trois semaines, mais les groupes ne sont pas fixes, ils <em>glissent</em> dans le temps. Nous entrons ici dans le domaine des moyennes/sommes/etc. <em>mobiles</em> ou <em>glissantes</em>‚Ä¶</p>
<section id="somme-cumul√©e" class="level5"><h5 class="anchored" data-anchor-id="somme-cumul√©e">Somme cumul√©e</h5>
<p>Nous allons utiliser la fonction <code>rollapply()</code> du paquet <code>{zoo}</code> pour calculer la somme cumul√©e car elle est polyvalente et puissante. Comme son nom l‚Äôindique, la fonction <code>rollapply()</code> <em>applique</em> une fonction de mani√®re glissante (<em>roll</em> peut √™tre traduit ici en ‚Äúrouler‚Äù) √† un vecteur ou √† une colonne d‚Äôun data frame.</p>
<p>Comme nous sommes contraint par le temps, nous allons vous fournir ici le code pour calculer la somme cumul√©e, et nous vous donnerons plus de d√©tails sur la fonction dans la section <a href="#sec-going-further">Aller plus loin</a> que vous pourrez lire quand vous aurez le temps.</p>
<p>Voici comment utiliser la fonction pour une zone de sant√© :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cr√©e un mini data frame pour l'exemple</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>exemple_df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">province   =</span> <span class="st">"Haut Katanga"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">zone_sante =</span> <span class="st">"Dilolo"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">semaine    =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">totalcas   =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> <span class="dv">10</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>exemple_df </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       province zone_sante semaine totalcas
1  Haut Katanga     Dilolo       1        1
2  Haut Katanga     Dilolo       2        1
3  Haut Katanga     Dilolo       3        1
4  Haut Katanga     Dilolo       4        1
5  Haut Katanga     Dilolo       5        1
6  Haut Katanga     Dilolo       6        1
7  Haut Katanga     Dilolo       7        1
8  Haut Katanga     Dilolo       8        1
9  Haut Katanga     Dilolo       9        1
10 Haut Katanga     Dilolo      10        1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>exemple_df <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cas_cumu =</span> <span class="fu">rollapply</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data  =</span> totalcas,   <span class="co"># La colonne cible</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">3</span>,          <span class="co"># La taille de la fen√™tre  </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN   =</span> sum,        <span class="co"># La fonction √† appliquer, ici la somme</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"right"</span>,    <span class="co"># On cumule les valeurs pass√©es jusqu'√† pr√©sent</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">partial =</span> <span class="cn">TRUE</span>,     <span class="co"># Les somme partielles sont autoris√©es</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>        <span class="co"># Argument en plus √† passer √† la fonction sum()</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       province zone_sante semaine totalcas cas_cumu
1  Haut Katanga     Dilolo       1        1        1
2  Haut Katanga     Dilolo       2        1        2
3  Haut Katanga     Dilolo       3        1        3
4  Haut Katanga     Dilolo       4        1        3
5  Haut Katanga     Dilolo       5        1        3
6  Haut Katanga     Dilolo       6        1        3
7  Haut Katanga     Dilolo       7        1        3
8  Haut Katanga     Dilolo       8        1        3
9  Haut Katanga     Dilolo       9        1        3
10 Haut Katanga     Dilolo      10        1        3</code></pre>
</div>
</div>
<p>Ok, mais nous voudrions utiliser cette fonction dans un data frame qui contient plusieurs zones de sant√©, et faire la somme cumul√©e <em>par zone de sant√©</em>. Ce n‚Äôest pas si compliqu√© : nous allons trier notre jeu de donn√©es par zone de sant√© et semaine, puis utiliser l‚Äôargument <code>.by</code> dans le mutate pour effectuer les actions <em>par zone de sant√©</em>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Rappelez-vous, nous avons d√©j√† vu le <code>.by</code>. Nous l‚Äôavons utilis√© au sein de la fonction <code>summarize()</code> lors de la session sur les <a href="../sessions_core/05_summary_table.html#sec-stratify">tableaux agr√©g√©s</a> pour faire des r√©sum√©s <em>par groupe</em>.</p>
<p>C‚Äôest la m√™me id√©e aujourd‚Äôhui, sauf qu‚Äôau lieux d‚Äôutiliser une fonction qui ne renvoie qu‚Äôune seule valeur par groupe (<code>summarize()</code>) nous allons utiliser une fonction qui retourne une valeur par <strong>ligne</strong> (<code>mutate()</code>), mais prendra en compte les informations du groupe.</p>
<p>Pour petit rappel de comment <code>summarize()</code> + <code>.by</code> fonctionne, voici comment nous calculons le nombre total de cas suspects et d√©c√®s par province :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_surv_sem <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> province,  <span class="co"># Fait les choses PAR province</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cas_tot   =</span> <span class="fu">sum</span>(totalcas, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">deces_tot =</span> <span class="fu">sum</span>(totaldeces, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 3
  province     cas_tot deces_tot
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 haut_katanga    5948        34
2 haut_lomami     6928        70
3 lualaba         1485         3
4 tanganyika      7836       137</code></pre>
</div>
</div>
</div>
</div>
<div class="write">
<ol type="1">
<li>Ajoutez une √©tape √† votre pipeline pour trier les donn√©es par province, zone de sant√© et semaine (dans cet ordre) avec la fonction <code>arrange()</code>, qui est une fonction de tri du package <code>{dplyr}</code>:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_surv_sem <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(province, zone_sante, semaine)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Ajoutez ensuite le code pour calculer la somme cumul√©e :</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.by =</span> <span class="fu">c</span>(province, zone_sante),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cas_cumu =</span> <span class="fu">rollapply</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data  =</span> totalcas,   <span class="co"># La colonne cible</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">3</span>,          <span class="co"># La taille de la fen√™tre  </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN   =</span> sum,        <span class="co"># La fonction √† appliquer, ici la somme</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"right"</span>,    <span class="co"># On cumule les valeurs pass√©es jusqu'√† pr√©sent</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">partial =</span> <span class="cn">TRUE</span>,     <span class="co"># Les somme partielles sont autoris√©es</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>        <span class="co"># Argument en plus √† passer √† la fonction sum()</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Maintenant que la somme cumul√©e est calcul√©e, il ne nous reste plus qu‚Äô√† calculer l‚Äôindicateur dichotomique qui r√©sume les donn√©es cumul√©es pour chaque semaine, puis un indicateur combin√© qui r√©sume les deux indicateurs pr√©c√©dents.</p>
<div class="write">
<ol type="1">
<li><p>Ajoutez une nouvelle √©tape √† votre pipeline pour cr√©er une colonne <code>cas_cumu35</code> qui contient <code>1</code> si la somme cumul√©e est sup√©rieure ou √©gale √† 35, et <code>0</code> sinon.</p></li>
<li><p>Dans le m√™me mutate, ajoutez une colonne <code>alerte</code>, qui est <code>1</code> si ‚Äôl‚Äôindicateur <code>cas20</code> OU l‚Äôindicateur <code>cas_cumu35</code> est <code>1</code> et <code>0</code> sinon. Pour lest logique vous devrez utiliser l‚Äôop√©rateur <code>|</code> qui repr√©sente le <strong>OU</strong> logique (renverra <code>TRUE</code> si au moins une des conditions est remplie, √† fortiori les deux).</p></li>
<li><p>Assignez le r√©sultat √† un data frame <code>data_alerte</code>.</p></li>
</ol>
<p>Ce data frame ressemble √† ceci (quelques colonnes sont cach√©es pour l‚Äôaffichage) :</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 7
   zone_sante semaine totalcas cas20 cas_cumu cas_cumu35 alerte
   &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
 1 kampemba         1       75     1       75          1      1
 2 kampemba         2       42     1      117          1      1
 3 kampemba         3       46     1      163          1      1
 4 kampemba         4       50     1      138          1      1
 5 kampemba         5       43     1      139          1      1
 6 kampemba         6       33     1      126          1      1
 7 kampemba         7       45     1      121          1      1
 8 kampemba         8       52     1      130          1      1
 9 kampemba         9       38     1      135          1      1
10 kampemba        10       46     1      136          1      1</code></pre>
</div>
</div>
</div>
</section></section></section><section id="zones-de-sant√©-en-alerte" class="level3"><h3 class="anchored" data-anchor-id="zones-de-sant√©-en-alerte">Zones de sant√© en alerte</h3>
<p>Maintenant que la pr√©paration est finie, nous pouvons <em>enfin</em> regarder quelles zones de sant√© sont en alerte dans notre jeu de donn√©es, en particulier √† la semaine 20 (les donn√©es les plus r√©centes selon l‚Äô√©tude de cas).</p>
<div class="write">
<p>Affichez les donn√©es filtr√©es pour ne voir que ce qui se passe √† la semaine 20. Quelle zones sont en alerte en ce moment ?</p>
<p>Cr√©ez un vecteur <code>zs_alerte</code> qui contient le nom des zones de sant√© qui sont en alerte √† la semaine 20. Ce vecteur sera utilis√© par la suite pour filtrer les donn√©es lors de l‚Äôanalyse.</p>
</div>
</section></section><section id="tracer-la-courbe-√©pid√©mique-question-4" class="level2"><h2 class="anchored" data-anchor-id="tracer-la-courbe-√©pid√©mique-question-4">Tracer la courbe √©pid√©mique (Question 4)</h2>
<p>Nous allons √† pr√©sent tracer la courbe √©pi pour les zones en alerte √† la semaine 20. Nous pouvons r√©utiliser le code vu lors de la session sur les <a href="../sessions_core/06_epicurves.html">courbes √©pid√©miques</a> : nous utiliserons le paquet <code>ggplot()</code> et la fonction <code>geom_col()</code> pour cr√©er un diagramme qui montre la distribution des cas par semaine. Petite nouveaut√© : par le pass√© nous avions une liste linaire o√π une ligne correspond √† un patient, donc un cas. Aujourd‚Äôhui nous avons des donn√©es d√©j√† agr√©g√©es par semaine et zone de sant√© : nul besoin de <em>compter</em> le nombre de cas nous m√™me.</p>
<div class="write">
<p>Tracez la courbe √©pid√©mique pour <em>une</em> des zones de sant√© en alerte.</p>
<p><br> Le graphe devrait ressembler √† ceci (peut √™tre avez-vous choisi l‚Äôautre zone) :</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="surveillance_companion_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Nouvelle fonction utile, la fonction <code>facet_wrap()</code> permet de cr√©er plusieurs graphiques d‚Äôun seul coup rassembl√©s en une seule figure. Consultez le satellite sur le <a href="../sessions_extra/faceting.html">faceting</a> si vous voulez en savoir plus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_alerte <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(zone_sante <span class="sc">%in%</span> zone_sante_alertee) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> semaine, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> totalcas)) <span class="sc">+</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2E4573"</span>) <span class="sc">+</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Semaine"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N cas"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Zone de sant√© de Kampemba (en alerte)"</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(zone_sante))   <span class="co"># Un graphe par zone de sant√©</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="surveillance_companion_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section><section id="indicateurs-cl√©s-question-6" class="level2"><h2 class="anchored" data-anchor-id="indicateurs-cl√©s-question-6">Indicateurs cl√©s (Question 6)</h2>
<p>Nous pouvons calculer plus d‚Äôindicateurs sur les zones de sant√© pour nous aider √† d√©cider laquelle devrait faire l‚Äôobjet d‚Äôune enqu√™te (vu que vous n‚Äôavez pas le temps ni les ressources pour investiguer les deux).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cette partie utilise les fonctions d‚Äôaggr√©gation vues quand nous avons appris √† faire des <a href="../sessions_core/05_summary_table.html">tableaux r√©sum√©s</a>. N‚Äôh√©sitez pas √† vous rafra√Æchir si besoin.</p>
</div>
</div>
<section id="premi√®re-semaine-en-alerte" class="level3"><h3 class="anchored" data-anchor-id="premi√®re-semaine-en-alerte">Premi√®re semaine en alerte</h3>
<div class="write">
<p>Utilisez la fonction <code>summarize()</code> pour afficher les premi√®res semaines o√π les ZS sont pass√©es en alerte. Quelle zone de sant√© a √©t√© en alerte en premier ?</p>
</div>
</section><section id="indicateurs-des-donn√©es-de-surveillance" class="level3"><h3 class="anchored" data-anchor-id="indicateurs-des-donn√©es-de-surveillance">Indicateurs des donn√©es de surveillance</h3>
<p>Reprenons le jeu de donn√©es de surveillance avec toutes les colonnes, <code>df_surv</code>.</p>
<div class="write">
<ol type="1">
<li><p>Ajoutez-lui une colonne <code>cas_moins_5ans</code> qui contient le nombre total de cas rapport√©s ayant moins de cinq ans.</p></li>
<li><p>D√©rivez, pour chaque zone en alerte, les indicateurs suivants, organis√©s en un seul tableau :</p></li>
</ol>
<ul>
<li>Le nombre de cas</li>
<li>Le nombre de morts</li>
<li>Le nombre de moins de cinq ans</li>
<li>La mortalit√© en pourcentage</li>
<li>Le pourcentage de moins de cinq ans.</li>
</ul>
<p>Le r√©sultat ressemble √† :</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  zone_sante n_cas n_deces n_moins_5 p_moins_5 mortalite
1   kampemba   730       0       544  74.52055   0.00000
2     lwamba   256       2       233  91.01562   0.78125</code></pre>
</div>
</div>
</div>
</section><section id="indicateurs-des-donn√©es-labo" class="level3"><h3 class="anchored" data-anchor-id="indicateurs-des-donn√©es-labo">Indicateurs des donn√©es labo</h3>
<p>Int√©ressons-nous √† pr√©sent aux donn√©es de laboratoire pour compl√©ter les indicateurs pr√©c√©dents.</p>
<div class="write">
<p>Pour chacune des zones en alerte, d√©rivez les indicateurs suivants :</p>
<ul>
<li>Le nombre de patients test√©s pour la rougeole</li>
<li>Le nombre de positifs pour la rougeole</li>
<li>La proportion de positifs pour la rougeole</li>
<li>Le nombre de patients test√©s pour la rub√©ole</li>
<li>Le nombre de positifs pour la rub√©ole</li>
<li>La proportion de positifs pour la rub√©ole</li>
</ul>
<p>Le r√©sultat devrait ressembler √† ceci :</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  zone_sante n_test_roug n_test_roug_pos positivite_roug n_test_rub
1     lwamba          10               5       0.5000000         10
2   kampemba          14               4       0.2857143         14
  n_test_rub_pos positivite_rub
1              0     0.00000000
2              1     0.07142857</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si vous avez du mal avec cette question, rafra√Æchissez-vous sur les <a href="../sessions_core/05_summary_table.html#sec-summary-cond">r√©sum√©s conditionnels</a>.</p>
</div>
</div>
</section></section><section id="cest-fini" class="level2"><h2 class="anchored" data-anchor-id="cest-fini">C‚Äôest fini !</h2>
<p>Bravo, vous √™tes venus √† bout de ce tutoriel !</p>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/blob/main/solutions/extra/surveillance_module_solutions_fr.R">
<button class="btn btn-default"><i class="fa fa-save"></i> Solutions</button>
</a>
</div>
</div>
</section><section id="sec-going-further" class="level2"><h2 class="anchored" data-anchor-id="sec-going-further">Aller plus loin</h2>
<section id="explications-sur-complete" class="level3"><h3 class="anchored" data-anchor-id="explications-sur-complete">Explications sur <code>complete()</code>
</h3>
<p>Dans le mini exemple ci-dessous la zone de sant√© de Kitenge n‚Äôa pas de ligne pour la semaine 2 :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame simplifi√©, avec seulement trois semaines</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>exemple_df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">province   =</span> <span class="fu">c</span>(<span class="st">"haut_katanga"</span>, <span class="st">"haut_katanga"</span>, <span class="st">"haut_katanga"</span>, <span class="st">"haut_lomami"</span>, <span class="st">"haut_lomami"</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">zone_sante =</span> <span class="fu">c</span>(<span class="st">"likasi"</span>, <span class="st">"likasi"</span>, <span class="st">"likasi"</span>, <span class="st">"kitenge"</span>, <span class="st">"kitenge"</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">semaine    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">totalcas  =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>exemple_df</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      province zone_sante semaine totalcas
1 haut_katanga     likasi       1        2
2 haut_katanga     likasi       2        1
3 haut_katanga     likasi       3        3
4  haut_lomami    kitenge       1        1
5  haut_lomami    kitenge       3        2</code></pre>
</div>
</div>
<p>Nous pouvons utiliser le code suivant pour compl√©ter toutes les zones de sant√© pour qu‚Äôelles aient toutes les semaines possible, ici les semaine de un √† trois :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compl√©te la semaine manquante √† Kitenge</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>exemple_df <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nesting</span>(province, zone_sante), </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">semaine =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>),            <span class="co"># Vecteur de 1 √† 3</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">totalcas =</span> <span class="dv">0</span>)       <span class="co"># Remplir avec des z√©ros (sinon, NA par d√©faut)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  province     zone_sante semaine totalcas
  &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;
1 haut_katanga likasi           1        2
2 haut_katanga likasi           2        1
3 haut_katanga likasi           3        3
4 haut_lomami  kitenge          1        1
5 haut_lomami  kitenge          2        0
6 haut_lomami  kitenge          3        2</code></pre>
</div>
</div>
<p>Maintenant les deux zones de sant√© dans les deux provinces ont toutes les semaines possibles.</p>
<p>Vous vous demandez peut √™tre pourquoi nous avons √©crit <code>nesting(province, zone_sante)</code> au lieu de juste <code>zone_sante</code>. La raison est qu‚Äôil peut y avoir deux zones de sant√© avec le m√™me nom dans des provinces diff√©rentes. Nous devons donc tenir compte de la colonne <code>province</code>. L‚Äôargument <code>nesting()</code> indique √† la fonction de n‚Äôutiliser que les <em>combinaisons existantes</em> des deux colonnes dans le data frame.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Petit encart pour voir ce qui se serait pass√© si nous avions pass√© les deux colonnes √† la fonction <code>complete()</code> sans utiliser <code>nesting()</code> : la fonction aurait cr√©√© <em>toutes les combinaisons possibles</em> entre les cat√©gories des colonnes <code>province</code> et <code>zone_sante</code>, ce qui n‚Äôa pas de sens dans notre cas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>exemple_df <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    province, zone_sante, </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">semaine =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>),  <span class="co"># Vecteur de 1 √† 3</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">totalcas =</span> <span class="dv">0</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 √ó 4
   province     zone_sante semaine totalcas
   &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 haut_katanga kitenge          1        0
 2 haut_katanga kitenge          2        0
 3 haut_katanga kitenge          3        0
 4 haut_katanga likasi           1        2
 5 haut_katanga likasi           2        1
 6 haut_katanga likasi           3        3
 7 haut_lomami  kitenge          1        1
 8 haut_lomami  kitenge          2        0
 9 haut_lomami  kitenge          3        2
10 haut_lomami  likasi           1        0
11 haut_lomami  likasi           2        0
12 haut_lomami  likasi           3        0</code></pre>
</div>
</div>
</div>
</div>
<p>Comme la base de donn√©es va √™tre mise √† jour chaque semaine, il serait pratique de choisir <em>automatiquement</em> la plage des semaines qui doivent √™tre pr√©sentes dans les donn√©es. Pour √ßa, il nous suffit de remplacer les valeurs que nous avons cod√© <em>en dur</em> par la plus petite semaine existante dans les donn√©es et la plus grande :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>exemple_df <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nesting</span>(province, zone_sante),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">semaine =</span> <span class="fu">seq</span>(<span class="fu">min</span>(semaine, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),   <span class="co"># Vecteur allant du minimum</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">max</span>(semaine, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),  <span class="co"># au maximum de la colonne `semaine`</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">totalcas =</span> <span class="dv">0</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  province     zone_sante semaine totalcas
  &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;
1 haut_katanga likasi           1        2
2 haut_katanga likasi           2        1
3 haut_katanga likasi           3        3
4 haut_lomami  kitenge          1        1
5 haut_lomami  kitenge          2        0
6 haut_lomami  kitenge          3        2</code></pre>
</div>
</div>
</section><section id="explications-sur-rollaply" class="level3"><h3 class="anchored" data-anchor-id="explications-sur-rollaply">Explications sur <code>rollaply()</code>
</h3>
<p>Pour calculer la somme cumul√©e des cas sur trois semaine il nous faut <em>appliquer</em> (<em>apply</em> en anglais) la fonction sur des fen√™tres glissantes de trois semaines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vecteur pour les exemples</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>exemple_vect <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">time =</span> <span class="dv">10</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>exemple_vect</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data  =</span> exemple_vect,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">3</span>,       <span class="co"># Largeur de la fen√™tre</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN   =</span> sum,     <span class="co"># Fonction √† appliquer (ici, la somme)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"right"</span>  <span class="co"># Calcul dans le pass√©</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 3 3 3 3 3 3</code></pre>
</div>
</div>
<p>Nous avons fourni en entr√©e un vecteur de 10 valeurs et obtenu en sortie un vecteur contenant les sommes. Manifestement, la fonction a fait des choix sur comment traiter les extr√©mit√©s, et le r√©sultat est plus court que le vecteur d‚Äôentr√©. Ce dernier point est un probl√®me si l‚Äôon veut utiliser la fonction dans un <code>mutate()</code>, qi cr√©e des colonnes dans un data frame, o√π toutes les colonnes ont la m√™me taille.</p>
<p>Il est possible de contr√¥ler le comportement de la fonction aux extr√©mit√©s :</p>
<ul>
<li>Remplir les valeurs pour lesquelles il n‚Äôy a pas assez de valeur dans la fen√™tre avec des <code>NA</code>
</li>
<li>Autoriser des calculs partiels (ici, des sommes partielles, en d‚Äôautres termes des valeurs ne repr√©sentent pas la somme sur <em>trois</em> semaines).</li>
</ul>
<p>L‚Äôargument <code>fill = NA</code> remplit les valeurs manquantes aux extr√©mit√©s concern√©es avec des <code>NA</code> (dans notre cas, √† gauche, vu que l‚Äôon a align√© la fen√™tre √† droite) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data  =</span> exemple_vect,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">3</span>,       <span class="co"># Largeur de la fen√™tre</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN   =</span> sum,     <span class="co"># Fonction √† appliquer (ici, la somme)</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"right"</span>, <span class="co"># Calcul dans le pass√©</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill  =</span> <span class="cn">NA</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA NA  3  3  3  3  3  3  3  3</code></pre>
</div>
</div>
<p>C‚Äôest souvent une fa√ßon raisonnable de g√©rer les valeurs aux extr√©mit√©s o√π les fen√™tres ne sont pas compl√®tes. N√©anmoins, dans notre cas, nous pouvons faire mieux. En effet, imaginons qu‚Äôil y ait 40 cas lors de la premi√®re semaine : m√™me si nous n‚Äôavons pas de valeurs pour les deux semaines pr√©c√©dentes, l‚Äôalerte devrait √™tre d√©clench√©e ! Nous voudrions donc que la somme cumul√©e soit calcul√©e <em>d√®s la premi√®re semaine</em> pour pouvoir d√©tecter des alertes pr√©coces ! L‚Äôargument <code>partial = TRUE</code> permet cela :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> exemple_vect,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">3</span>,        <span class="co"># Largeur de la fen√™tre</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN   =</span> sum,      <span class="co"># Fonction √† appliquer (ici, la somme)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"right"</span>,  <span class="co"># Calcul dans le pass√©</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">partial =</span> <span class="cn">TRUE</span>    <span class="co"># Autorise les sommes partielles aux extr√©mit√©s</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 3 3 3 3 3 3 3</code></pre>
</div>
</div>
<p>C‚Äôest mieux comme √ßa pour notre cas d‚Äôusage.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gardez √† l‚Äôesprit que les deux premi√®res valeurs du vecteur (ou de la colonne) contiennent donc des sommes <em>partielles</em>. En cons√©quence, une <em>absence d‚Äôalerte</em> dans les deux premi√®res semaines ne veut pas forcement dire grand chose.</p>
</div>
</div>
<p>Un dernier point : rappelez-vous qu‚Äôil faut utiliser <code>na.rm = TRUE</code> pour ignorer les valeurs manquantes dans la plupart des op√©rations arithm√©tiques dans R.</p>
<p>Si nous avions un vecteur un peu moins complet, nous aurions des probl√®mes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>exemple_vect_na <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data  =</span> exemple_vect_na,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">3</span>,       <span class="co"># Largeur de la fen√™tre</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN   =</span> sum,     <span class="co"># Fonction √† appliquer (ici, la somme)</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"right"</span>, <span class="co"># Calcul dans le pass√©</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">partial =</span> <span class="cn">TRUE</span>   <span class="co"># Autorise les sommes partielles aux extr√©mit√©s</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  2  3 NA NA NA</code></pre>
</div>
</div>
<p>Oups. Heureusement, nous pouvons passer l‚Äôargument <code>na.rm = TRUE</code> √† la fonction <code>rollapply()</code> pour qu‚Äôelle le passe √† la fonction <code>sum()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data  =</span> exemple_vect_na,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">3</span>,       <span class="co"># Largeur de la fen√™tre</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN   =</span> sum,     <span class="co"># Fonction √† appliquer (ici, la somme)</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"right"</span>, <span class="co"># Calcul dans le pass√©</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">partial =</span> <span class="cn">TRUE</span>,  <span class="co"># Autorise les sommes partielles aux extr√©mit√©s</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>     <span class="co"># Argument en plus non nomm√© √† passer √† sum()</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 2 2 2</code></pre>
</div>
</div>
<p>Enfin, quelues mots sur l‚Äôargument <code>align</code>. Il d√©finit la position de la fen√™tre glissante par rapport √† la valeur en train d‚Äô√™tre calcul√©e. Par d√©faut la fen√™tre est centr√©e autour de la valeur √† cacluler : la valeur calcul√©e <em>i</em> est la somme des valeurs <em>i-1</em> (la valeur pr√©c√©dente) et la valeur <em>i+1</em> (la valeur suivante).</p>
<p>Exemples des trois alignements (en mettant des valeurs manquantes aux extr√©mit√©s pour voir plus facilement ce qui se passe) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alignement √† gauche : la valeur est la somme des valeurs dans le futur</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(<span class="at">data  =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">3</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">FUN   =</span> sum,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">"left"</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16 13  8 17 NA NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alignement centr√© : somme des valeurs de chaque c√¥t√©</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(<span class="at">data  =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">3</span>, </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">FUN   =</span> sum,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="cn">NA</span>)  <span class="co"># The default</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA 16 13  8 17 NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alignement √† droite : somme des valeurs pass√©es jusqu'√† pr√©sent</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rollapply</span>(<span class="at">data  =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">3</span>, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">FUN   =</span> sum,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">"right"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA NA 16 13  8 17</code></pre>
</div>
</div>
<p>Dans notre cas, nous voulons que la valeur pour une semaine donn√©e refl√®te cette semaine et les deux semaines pr√©c√©dentes, donc nous utilisons l‚Äôargument <code>align = "right"</code>, pour calculer <em>dans le pass√©</em>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dans ce tutoriel nous avons appliqu√© la fonction <code>sum()</code> √† des fen√™tres de trois semaines pour calculer une <em>somme cumul√©e</em>. Mais le code peut √™tre facilement modifi√© pour calculer une <em>moyenne glissante</em> sur une fen√™tre de votre choix !</p>
</div>
</div>
</section><section id="formatage-des-pourcentages" class="level3"><h3 class="anchored" data-anchor-id="formatage-des-pourcentages">Formatage des pourcentages</h3>
<p>La fonction <code>percent()</code> du paquet <code>{scales}</code> formate une valeur ou un vecteur de valeurs en pourcentages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fl">0.8556</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il y a un argument <code>accuracy</code> pour contr√¥ler le nombre de d√©cimales √† afficher :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fl">0.8556</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vous pouvez fournir un vecteur (ou une colonne !) de proportions √† la fonction pour afficher les valeurs en pourcentages, ce qui est plus lisible dans un tableau r√©sum√©.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>La colonne ainsi cr√©e <em>n‚Äôest plus</em> une colonne num√©rique : l‚Äôajout du signe <code>%</code> transforme la colonne en texte. Vous ne pourrez donc plus effectuer d‚Äôop√©rations arithm√©tiques dessus.</p>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copi√©");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copi√©");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body>
</html>
