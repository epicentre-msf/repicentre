<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2024-11-26">
<meta name="description" content="Learn how to import multiple sheets from an Excel file, or several Excel files.">
<title>Import multiple files and sheets – Repicentre</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-523b4dc3dad50da7e5c9dee1e7f3f290.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../styles.css">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Repicentre</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pathway.html"> 
<span class="menu-text">Pathway</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../explore.html"> 
<span class="menu-text">Explore</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li>
<a href="#import-multiple-sheets" id="toc-import-multiple-sheets" class="nav-link" data-scroll-target="#import-multiple-sheets">Import Multiple Sheets</a>
  <ul>
<li><a href="#bind-into-a-dataframe" id="toc-bind-into-a-dataframe" class="nav-link" data-scroll-target="#bind-into-a-dataframe">Bind Into a Dataframe</a></li>
  <li><a href="#slightly-more-messy-sheets" id="toc-slightly-more-messy-sheets" class="nav-link" data-scroll-target="#slightly-more-messy-sheets">Slightly More Messy Sheets</a></li>
  </ul>
</li>
  <li>
<a href="#import-multiple-files" id="toc-import-multiple-files" class="nav-link" data-scroll-target="#import-multiple-files">Import Multiple files</a>
  <ul>
<li>
<a href="#get-file-paths-with-file.path" id="toc-get-file-paths-with-file.path" class="nav-link" data-scroll-target="#get-file-paths-with-file.path">Get File Paths with <code>file.path()</code></a>
  <ul>
<li><a href="#list-all-the-files" id="toc-list-all-the-files" class="nav-link" data-scroll-target="#list-all-the-files">List All the Files</a></li>
  <li><a href="#keep-only-the-excel-files" id="toc-keep-only-the-excel-files" class="nav-link" data-scroll-target="#keep-only-the-excel-files">Keep Only the Excel files</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><script type="text/javascript" src="../script.js"></script><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Import multiple files and sheets</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Satellite</div>
    <div class="quarto-category">Import data</div>
    <div class="quarto-category">Multiple files</div>
    <div class="quarto-category">list.files</div>
  </div>
  </div>

<div>
  <div class="description">
    Learn how to import multiple sheets from an Excel file, or several Excel files.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 26, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><!-- ![](../img/under_construction.svg) --><section id="objectives" class="level2"><h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Learn to efficiently import data from several files</li>
<li>Learn to efficiently import data from several sheets in the same file</li>
</ul></section><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the <a href="../sessions_core/import_data.html">import data</a> core session your learned how to use <a href="https://gesistsa.github.io/rio/">rio</a> <a href="https://gesistsa.github.io/rio/index.html#supported-file-formats">package</a> to import any file formats, and in particular <code>.xlsx</code> and <code>.csv</code> files, which will probably cover 90% of your needs. In this session we will tackle the very common problem of <em>scaterred data</em>.</p>
<p>You may have already encountered these situations:</p>
<ul>
<li><p>You have an Excel file with data in several sheets (linelist data, lab data, bed occupancy) and you need to import it all</p></li>
<li><p>You have several Excel files (linelist data, lab data, bed occupancy) with data to import.</p></li>
<li><p>You have an Excel file with data in several sheets, and all the sheets are formatted the same, and you wish the data was all together. A prime example of it is linelist or aggregated data where one sheet represent one week, or one district, and there are about 20 sheets…</p></li>
<li><p>You have multiple Excel file, all formatted the same (one linelist per site, for exemple)</p></li>
</ul>
<p>The two first cases can be solved with several calls to the different sheets or files, and storing the data in different dataframes. If there are not too many files or shit, it is fine. The two last cases should however be automatized!</p>
<p>The following session will help with all of them anyway: the <a href="https://gesistsa.github.io/rio/">rio</a> package has a <code>import_list()</code> function that can import several <em>items</em> in one go. These items can be files or sheets depending on what you provide as arguments.</p>
</section><section id="setup" class="level2"><h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>We expect you to be working in the course project. You can add this tutorial to your <code>import_data.R</code> script that you created in the <a href="../sessions_core/import_data.html">Import data core session</a>, or create a new script.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> If you are working in a new script, add metadata about it at the top and load the <a href="https://gesistsa.github.io/rio/">rio</a> and <a href="https://here.r-lib.org/">here</a> packages. Then create a <code>path_data_raw</code> object that points to the directory <code>data / raw</code> of the course folder.</p>
</div>
</div>
</div>
</section><section id="import-multiple-sheets" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="import-multiple-sheets">Import Multiple Sheets</h2>
<p>The <code>import_list()</code> function can import all the sheets from a Excel file<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and store them into a <a href="../sessions_extra/lists.html">list</a>. It avoids you having to write multiple <code>import()</code> commands for each file separately.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Or, in fact, all items from a multi-object file such as <code>.Rdata</code> or <code>.zip</code></p></div></div><div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># returns a list of dataframes</span></span>
<span><span class="fu">import_list</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist.xlsx"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now imagine someone gave you lab data with the positive, negative and inconclusive scattered in three different sheets.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Let’s import this data.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;You wonder why they did that but you probably have seen weirder things.</p></div></div><div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Look.</strong> In the course folder, go to the subfolder <code>data / raw / multiple_sheets</code>. There are two modified version of the lab data. Open them and look at their structure. Do you see how the second file differs form the first one?</p>
</div>
</div>
</div>
<p>We will tackle the first file, as it is less messy.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Use the <code>import_list()</code> function to import all the sheets of <code>msf_laboratory_moissala_2023-09-24_first.xlsx</code>in one go, and store it in an object called <code>lab_data_list</code>.</p>
</div>
</div>
</div>
<p>The object <code>lab_data_list</code> is a <strong>list</strong> that contains several dataframes (one dataframe per sheet). Maybe you have not followed the <a href="../sessions_extra/lists.html">list</a> satellite yet and are not sure what to do with it. For now, let’s just peek at it. You can inspect its structure with well known tools:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">lab_data_list</span><span class="op">)</span>     <span class="co"># Structure of the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ inconclusive:'data.frame':   58 obs. of  5 variables:
  ..$ MSF Number ID    : num [1:58] 147 414 455 469 533 ...
  ..$ Laboratory id    : chr [1:58] "BOU-4" "MOI-5" "DAN-12" "DAN-13" ...
  ..$ Date of the test : POSIXct[1:58], format: "2022-10-12 18:40:49" "2022-12-09 05:55:56" ...
  ..$ CT value         : logi [1:58] NA NA NA NA NA NA ...
  ..$ Final Test Result: chr [1:58] "inconclusive" "inconclusive" "inconclusive" "inconclusive" ...
 $ negative    :'data.frame':   101 obs. of  5 variables:
  ..$ MSF Number ID    : num [1:101] 13 397 416 490 767 ...
  ..$ Laboratory id    : chr [1:101] "DAN-1" "DAN-9" "BOU-12" "BEK-12" ...
  ..$ Date of the test : POSIXct[1:101], format: "2022-09-10 21:25:04" "2022-11-21 20:02:44" ...
  ..$ CT value         : logi [1:101] NA NA NA NA NA NA ...
  ..$ Final Test Result: chr [1:101] "negative" "negative" "negative" "negative" ...
 $ positive    :'data.frame':   888 obs. of  5 variables:
  ..$ MSF Number ID    : num [1:888] 1 10 21 39 62 71 73 75 105 107 ...
  ..$ Laboratory id    : chr [1:888] "BED-1" "KOU-1" "DAN-2" "BEK-1" ...
  ..$ Date of the test : POSIXct[1:888], format: "2022-08-20 00:00:00" "2022-09-04 15:21:36" ...
  ..$ CT value         : num [1:888] 27 26.9 28.1 27.2 26.3 26 27.8 28.9 26.8 25.9 ...
  ..$ Final Test Result: chr [1:888] "positive" "positive" "positive" "positive" ...</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lab_data_list</span><span class="op">)</span>  <span class="co"># Nb of items in the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lab_data_list</span><span class="op">)</span>   <span class="co"># Name of the items of the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "inconclusive" "negative"     "positive"    </code></pre>
</div>
</div>
<p>You can also go and click on the list <a href="../sessions_core/import_data.html#sec-envt">in the Environment panel</a> to inspect its structure, and open it in the Viewer, as we did for dataframes.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Look.</strong> The View is a bit different. Click on the buttons you see and see what happens.</p>
<p><strong>Hint</strong> There are buttons that you can click on both on the left and right of the Viewer pane.</p>
</div>
</div>
</div>
<p>You can access elements of the list with these commands<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>:</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;we added the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> function to shorten the output, but you can remove it to print the whole elements.</p></div></div><div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lab_data_list</span><span class="op">$</span><span class="va">positive</span><span class="op">)</span>  <span class="co"># Access by name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MSF Number ID Laboratory id    Date of the test CT value Final Test Result
1             1         BED-1 2022-08-20 00:00:00     27.0          positive
2            10         KOU-1 2022-09-04 15:21:36     26.9          positive
3            21         DAN-2 2022-09-12 00:54:38     28.1          positive
4            39         BEK-1 2022-09-15 02:31:22     27.2          positive
5            62         BOU-1 2022-09-30 17:51:01     26.3          positive
6            71         BEK-2 2022-10-02 15:03:51     26.0          positive</code></pre>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lab_data_list</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>        <span class="co"># Access by position the first element of the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$inconclusive
   MSF Number ID  Laboratory id    Date of the test CT value Final Test Result
1            147          BOU-4 2022-10-12 18:40:49       NA      inconclusive
2            414          MOI-5 2022-12-09 05:55:56       NA      inconclusive
3            455         DAN-12 2022-11-22 17:09:53       NA      inconclusive
4            469         DAN-13 2022-11-18 07:03:57       NA      inconclusive
5            533          MOI-9 2023-01-05 03:38:26       NA      inconclusive
6            882         DAN-21 2023-02-05 21:57:09       NA      inconclusive
7           1070         BEK-20 2023-01-29 19:46:36       NA      inconclusive
8           1163         BEK-25 2023-02-08 01:12:21       NA      inconclusive
9           1326         BED-11 2023-02-23 22:48:47       NA      inconclusive
10          1600         DAN-31 2023-03-03 12:47:31       NA      inconclusive
11          1869         MOI-50 2023-03-18 00:41:43       NA      inconclusive
12          1948         MOI-56 2023-04-01 08:46:37       NA      inconclusive
13          1987         BOU-42 2023-03-16 15:04:54       NA      inconclusive
14          2242         MOI-73 2023-03-27 10:37:40       NA      inconclusive
15          2268         MOI-74 2023-04-07 13:24:03       NA      inconclusive
16          2449         BOU-48 2023-04-29 23:22:57       NA      inconclusive
17          2536         MOI-91 2023-04-07 11:09:42       NA      inconclusive
18          2928        MOI-124 2023-04-21 09:21:41       NA      inconclusive
19          3068        MOI-136 2023-04-25 03:29:41       NA      inconclusive
20          3580        MOI-166 2023-05-07 09:01:07       NA      inconclusive
21          3759        MOI-175 2023-06-02 18:53:39       NA      inconclusive
22          3820        MOI-177 2023-05-12 06:22:39       NA      inconclusive
23          3928         BED-61 2023-06-09 07:45:48       NA      inconclusive
24          4050         BOU-74 2023-06-18 12:26:59       NA      inconclusive
25          4316         BED-70 2023-06-02 23:11:48       NA      inconclusive
26          4331         BOU-80 2023-06-06 15:23:00       NA      inconclusive
27          4609        MOI-216 2023-07-14 06:03:25       NA      inconclusive
28          4680        MOI-225 2023-07-19 17:24:27       NA      inconclusive
29          4721        MOI-229 2023-07-22 12:43:41       NA      inconclusive
30          5025         BOU-86 2023-06-05 04:24:20       NA      inconclusive
31          5111        MOI-249 2023-08-04 17:51:58       NA      inconclusive
32          5283        MOI-261 2023-08-12 09:09:33       NA      inconclusive
33          5337         BED-91 2023-06-28 16:46:56       NA      inconclusive
34          5634        MOI-281 2023-08-27 08:31:02       NA      inconclusive
35          5844        MOI-297 2023-06-23 13:13:51       NA      inconclusive
36          6142        BOU-105 2023-09-06 17:26:24       NA      inconclusive
37          6591        MOI-346 2023-09-26 10:45:51       NA      inconclusive
38          6675        MOI-353 2023-08-02 07:21:04       NA      inconclusive
39          6788        BOU-113 2023-08-31 16:29:50       NA      inconclusive
40          6945        MOI-369 2023-07-13 08:48:11       NA      inconclusive
41          7236        BED-123 2023-07-31 09:45:47       NA      inconclusive
42          7314        MOI-395 2023-08-12 11:32:27       NA      inconclusive
43          7594        MOI-417 2023-08-15 09:00:03       NA      inconclusive
44          7743        MOI-432 2023-09-22 11:59:36       NA      inconclusive
45          7776        MOI-437 2023-10-21 17:40:38       NA      inconclusive
46          7876        MOI-442 2023-09-18 00:03:53       NA      inconclusive
47          7900        MOI-445 2023-08-06 18:07:45       NA      inconclusive
48          8076        MOI-454 2023-10-01 19:23:50       NA      inconclusive
49          8317        MOI-471 2023-08-09 17:52:31       NA      inconclusive
50          8332        MOI-473 2023-08-21 03:51:30       NA      inconclusive
51          8772        MOI-496 2023-09-25 00:47:21       NA      inconclusive
52          8834        MOI-502 2023-10-20 12:12:01       NA      inconclusive
53          9089        BED-156 2023-10-22 04:24:13       NA      inconclusive
54          9090        MOI-519 2023-10-15 19:57:32       NA      inconclusive
55          9564        MOI-550 2023-10-15 12:26:19       NA      inconclusive
56          9859        BED-166 2023-11-06 09:27:17       NA      inconclusive
57          9917        MOI-585 2023-11-12 22:42:52       NA      inconclusive
58          9917 MOI-585_retest 2023-11-14 22:42:52       NA      inconclusive</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lab_data_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>      <span class="co"># Access the content of the first element</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MSF Number ID Laboratory id    Date of the test CT value Final Test Result
1           147         BOU-4 2022-10-12 18:40:49       NA      inconclusive
2           414         MOI-5 2022-12-09 05:55:56       NA      inconclusive
3           455        DAN-12 2022-11-22 17:09:53       NA      inconclusive
4           469        DAN-13 2022-11-18 07:03:57       NA      inconclusive
5           533         MOI-9 2023-01-05 03:38:26       NA      inconclusive
6           882        DAN-21 2023-02-05 21:57:09       NA      inconclusive</code></pre>
</div>
</div>
<section id="bind-into-a-dataframe" class="level3"><h3 class="anchored" data-anchor-id="bind-into-a-dataframe">Bind Into a Dataframe</h3>
<p>If you know that the data in all the sheets have the same structure, you can tell R to bind all of these tables into a single dataframe (rowwise) by setting the argument <code>rbind =</code> to <code>TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Returns a single dataframe:</span></span>
<span><span class="fu">import_list</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist.xlsx"</span><span class="op">)</span>, </span>
<span>  rbind <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co"># Tells R to bind list elements together</span></span>
<span>  rbind_label <span class="op">=</span> <span class="st">"Sheet_position"</span>   <span class="co"># Optional: name the column of the source of data</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Use the <code>import_list()</code> function to import all the sheets of <code>msf_laboratory_moissala_2023-09-24_first.xlsx</code>in one go, and store it in an object called <code>lab_data</code>, which is a <em>single dataframe</em> containing all the data.</p>
</div>
</div>
</div>
<p>You may use the <code>rbind_label =</code> argument and provide a string for the column name, or nor and see what happens.</p>
</section><section id="slightly-more-messy-sheets" class="level3"><h3 class="anchored" data-anchor-id="slightly-more-messy-sheets">Slightly More Messy Sheets</h3>
<p>Now, let’s focus on the second dataframe provided, <code>msf_laboratory_moissala_2023-09-24_second.xlsx</code>. By now you should have realized that this data is more messy:</p>
<ul>
<li>the <code>CT value</code> volumn exists only in the third sheet</li>
<li>the <code>Laboratory id</code> is not in the same position in the three sheets</li>
<li>The date of the test does not have the same name in all sheets</li>
</ul>
<p>Let’s see how the <code>import_list()</code> function behaves in these conditions:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lab_data_messy</span> <span class="op">&lt;-</span> <span class="fu">import_list</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"multiple_sheets"</span>,</span>
<span>       <span class="st">"msf_laboratory_moissala_2023-09-24_second.xlsx"</span><span class="op">)</span>,</span>
<span>  rbind <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rbind_label <span class="op">=</span> <span class="st">"Sheet_position"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Look.</strong> Run the above code and use the tools that you know to inspect the structure and content of the <code>lab_data_messy</code> object.</p>
<ul>
<li>What happened to the <code>CT value</code> columns? Was it imported? If yes, how was it filled?</li>
<li>What happened to the <code>Laboratory id</code> columns? Was it imported? If yes, how was it filled?</li>
<li>What happened to the dates columns? Were they ignored?</li>
</ul>
</div>
</div>
</div>
<p>As you can see the function behaves reasonably:</p>
<ul>
<li>columns are <strong>matched by name</strong>, so if a column exists in all sheets <em>and has the same name</em>, the data is gathered in the same column, independantly of its position</li>
<li>the corrolary is that columns with different names are treated as different columns, so check your names!</li>
<li>if a column exist in one sheet and not the others, the column will exist in the final dataframe, but the values will be <code>NA</code> for the rows coming from sheets without the column (<a href="../sessions_core/introduction.html#sec-missing-values">don’t remember what <code>NA</code> means?</a>).</li>
</ul>
<p>You are now ready to import files with multiple sheets! Now let’s tackle data scattered in several files.</p>
</section></section><section id="import-multiple-files" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="import-multiple-files">Import Multiple files</h2>
<p>Fortunately, the <code>import_list()</code> function can also accept a vector of file names. In this case, it will import each of these files and store them into a <a href="../sessions_extra/lists.html">list</a>, unless you can use the <code>rbind = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a vector of (fictitious) files</span></span>
<span><span class="va">vector_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_A.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_B.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_C.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_D.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_E.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_F.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_G.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_H.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_I.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_J.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_K.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_L.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"example_linelist_M.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">import_list</span><span class="op">(</span><span class="va">vector_paths</span><span class="op">)</span> <span class="co"># returns a list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Look.</strong> Go to the subfolder <code>data / raw / multiple_files</code>. Open the files to check their content. Would it make sense to concatenate the data together at import in this case?</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Import all the Excel files in one go and store them in a dataframe called <code>linelist_data</code>.</p>
<p>Inspect the dataframe created: how many lines? How many columns? Was everything imported as you expected?</p>
</div>
</div>
</div>
<section id="get-file-paths-with-file.path" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="get-file-paths-with-file.path">Get File Paths with <code>file.path()</code>
</h3>
<section id="list-all-the-files" class="level4"><h4 class="anchored" data-anchor-id="list-all-the-files">List All the Files</h4>
<p>Manually listing the files that you want to import was fine for demonstrations purposes so that you understand what to pass to the <code>import_list()</code> function, but it is slow and error prone.</p>
<p>We will now use the function <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code> to automatically retrieve the file paths. Its main argument, <code>path =</code> takes a file path, and the function returns a simple vector of file names.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">path_mult</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">path_data_raw</span>, <span class="st">"multiple_files"</span><span class="op">)</span> <span class="co"># optional, to shorten the following code</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span><span class="op">)</span> <span class="co"># returns a vector of file names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a_document.txt"                                 
[2] "a_non_data_file.txt"                            
[3] "also_not_data.doc"                              
[4] "msf_linelist_moissala_2023-09-24_bedaya.xlsx"   
[5] "msf_linelist_moissala_2023-09-24_bekourou.xlsx" 
[6] "msf_linelist_moissala_2023-09-24_bouna.xlsx"    
[7] "msf_linelist_moissala_2023-09-24_danamadji.xlsx"
[8] "msf_linelist_moissala_2023-09-24_koumogo.xlsx"  
[9] "msf_linelist_moissala_2023-09-24_moissala.xlsx" </code></pre>
</div>
</div>
<p>We can ask the function to return the full paths of the files with the argument <code>full.names = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span>,</span>
<span>           full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/a_document.txt"                                 
[2] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/a_non_data_file.txt"                            
[3] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/also_not_data.doc"                              
[4] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/msf_linelist_moissala_2023-09-24_bedaya.xlsx"   
[5] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/msf_linelist_moissala_2023-09-24_bekourou.xlsx" 
[6] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/msf_linelist_moissala_2023-09-24_bouna.xlsx"    
[7] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/msf_linelist_moissala_2023-09-24_danamadji.xlsx"
[8] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/msf_linelist_moissala_2023-09-24_koumogo.xlsx"  
[9] "D:/MATHILDE_UNPLUGGED/5_OTHER/repicentre/data/raw/multiple_files/msf_linelist_moissala_2023-09-24_moissala.xlsx" </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that even if these are absolute paths, we used <a href="https://here.r-lib.org/">here</a> and relative paths within the course directory so the absolute paths will different but functional on your computer.</p>
</div>
</div>
</section><section id="keep-only-the-excel-files" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="keep-only-the-excel-files">Keep Only the Excel files</h4>
<p>Now, this is nice and all but there are those pesky files that are not Excel which we would like to avoid. An easy way is to use the <code>pattern =</code> argument of <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code>. It takes a string of text that is matched to the names of files, to keep only the ones you want.</p>
<p>The <code>pattern =</code> argument accepts <a href="https://r4ds.hadley.nz/regexps">regular expressions, or regex for short</a>, which are <em>way</em> out of our scope here<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Here we are only giving you pointers to create a simple pattern.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;Regular expressions have their own syntax that is not limited to R and are super powerful. They are also hard to use so if you are new to R you should probably wait a bit before diving into them.</p></div></div><p>The function will return file names that match the pattern:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># All file names that contain "bedaya":</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span>, pattern <span class="op">=</span> <span class="st">"bedaya"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "msf_linelist_moissala_2023-09-24_bedaya.xlsx"</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># All file names that contain "msf_linelist":</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span>, pattern <span class="op">=</span> <span class="st">"msf_linelist"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "msf_linelist_moissala_2023-09-24_bedaya.xlsx"   
[2] "msf_linelist_moissala_2023-09-24_bekourou.xlsx" 
[3] "msf_linelist_moissala_2023-09-24_bouna.xlsx"    
[4] "msf_linelist_moissala_2023-09-24_danamadji.xlsx"
[5] "msf_linelist_moissala_2023-09-24_koumogo.xlsx"  
[6] "msf_linelist_moissala_2023-09-24_moissala.xlsx" </code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># All file names that contain "msf_ll":</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span>, pattern <span class="op">=</span> <span class="st">"msf_ll"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># All the files that contain "doc"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span>, pattern <span class="op">=</span> <span class="st">"doc"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a_document.txt"    "also_not_data.doc"</code></pre>
</div>
</div>
<p>Did you notice at the end, two files contained “doc” in their name, one in its name, the other in its extension. If you want to select only the Word document, you need a more precise pattern.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get this word document for sure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_mult</span>, pattern <span class="op">=</span> <span class="st">"\\.doc$"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "also_not_data.doc"</code></pre>
</div>
</div>
<p>Here we modified the pattern to make it more restrictive:</p>
<ul>
<li>the <code>\\.</code> at the start is the regex way of saying that there should be a “.” before “doc”.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>
</li>
<li>the <code>$</code> at the end of the pattern indicates that this pattern should be at the end of the file name.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;It sound complicated because the “.” alone has a special meaning in regex, so we need to add the <code>\\</code>. Go <a href="https://r4ds.hadley.nz/regexps">read on regex</a>, or trust us for now.</p></div></div><p>So with this pattern we are looking for <em>files that contain “.doc” at the end of their names</em>.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Now, write a command using <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code> to automatically list all files that end with “.xlsx”. Then, update your previous code to import these files in one dataframe, as we did before.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The argument <code>recursive = TRUE</code> allows you to list files present in subdirectories of your path target, which can be handy if you have nested folders containing data.</p>
</div>
</div>


</section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>