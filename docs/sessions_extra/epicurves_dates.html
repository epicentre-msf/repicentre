<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2024-12-02">
<meta name="description" content="Display dates rather than epiweeks numbers on your epicurves">
<title>Epicurves with dates in x axis – Repicentre</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-523b4dc3dad50da7e5c9dee1e7f3f290.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../styles.css">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Repicentre</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pathway.html"> 
<span class="menu-text">Pathway</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../explore.html"> 
<span class="menu-text">Explore</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#objective" id="toc-objective" class="nav-link active" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#dependancies" id="toc-dependancies" class="nav-link" data-scroll-target="#dependancies">Dependancies</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#create-the-time-variable" id="toc-create-the-time-variable" class="nav-link" data-scroll-target="#create-the-time-variable">Create the time variable</a></li>
  <li><a href="#aggregate-by-week" id="toc-aggregate-by-week" class="nav-link" data-scroll-target="#aggregate-by-week">Aggregate by week</a></li>
  <li><a href="#draw-the-epicurve" id="toc-draw-the-epicurve" class="nav-link" data-scroll-target="#draw-the-epicurve">Draw the epicurve</a></li>
  <li>
<a href="#improve-the-axis-appearance-breaksand-labels" id="toc-improve-the-axis-appearance-breaksand-labels" class="nav-link" data-scroll-target="#improve-the-axis-appearance-breaksand-labels">Improve the axis appearance (breaksand labels)</a>
  <ul>
<li><a href="#change-breaks" id="toc-change-breaks" class="nav-link" data-scroll-target="#change-breaks">Change breaks</a></li>
  <li>
<a href="#labels" id="toc-labels" class="nav-link" data-scroll-target="#labels">Labels</a>
  <ul>
<li><a href="#with-the-scales-package." id="toc-with-the-scales-package." class="nav-link" data-scroll-target="#with-the-scales-package.">With the <code>{scales}</code> package.</a></li>
  <li><a href="#with-the-strptime-syntax" id="toc-with-the-strptime-syntax" class="nav-link" data-scroll-target="#with-the-strptime-syntax">With the <code>strptime</code> syntax</a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><script type="text/javascript" src="../script.js"></script><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Epicurves with dates in x axis</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Satellite</div>
    <div class="quarto-category">Graphs</div>
    <div class="quarto-category">ggplot2</div>
    <div class="quarto-category">epicurve</div>
    <div class="quarto-category">dates</div>
    <div class="quarto-category">scales</div>
  </div>
  </div>

<div>
  <div class="description">
    Display dates rather than epiweeks numbers on your epicurves
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="objective" class="level2"><h2 class="anchored" data-anchor-id="objective">Objective</h2>
<p>Learn to display dates on the x-axis of your graphs, and how to tweak the date labels.</p>
<p>In the <a href="../sessions_core/ggplot.html">introduction to ggplot session</a> you learned how to plot an epicurve of the number of cases across time.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In that graph we chose to represent epiweeks in the bottom axis, as it is a common task. In this session we will show how to code a variant of this graph with dates instead.</p>
<p>As in the core session, the examples will plot the epicurve for outcomes, and you will code the epicurve for hospitalizations.</p>
</section><section id="dependancies" class="level2"><h2 class="anchored" data-anchor-id="dependancies">Dependancies</h2>
<p>We will use the following packages in this session:</p>
<ul>
<li>
<a href="https://here.r-lib.org/">here</a> to write robust absolute paths,</li>
<li>
<a href="https://gesistsa.github.io/rio/">rio</a> to import the data,</li>
<li>
<a href="https://dplyr.tidyverse.org">dplyr</a> to manipulate data,</li>
<li>
<a href="https://ggplot2.tidyverse.org">ggplot2</a> to create the graphs,</li>
<li>
<a href="https://lubridate.tidyverse.org">lubridate</a> to manage dates and times</li>
<li>
<a href="https://scales.r-lib.org">scales</a> to create prettier lables</li>
</ul></section><section id="setup" class="level2"><h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>We use the same setup as the one from the <a href="../sessions_core/ggplot.html#sec-epicurve-steps">ggplot core session</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Import clean data ----------------------------------------</span></span>
<span><span class="va">df_linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="http://gesistsa.github.io/rio/reference/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">'data'</span>, <span class="st">'clean'</span>,</span>
<span>                                      <span class="st">'linelist_moissala_2023-09-24_clean.rds'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_admission</span>, <span class="va">date_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>week_admission <span class="op">=</span> <span class="fu">isoweek</span><span class="op">(</span><span class="va">date_admission</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Used to plot the weeks ISO</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid the warnings all along the session, we removed the missing values <em>both</em> in the admission date and outcome date columns. When you analyse and plot data, always be aware of how many missing data you have and how a <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">tidyr::drop_na()</a></code> command affects your dataframe.</p>
</div>
</div>
</section><section id="create-the-time-variable" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="create-the-time-variable">Create the time variable</h2>
<p>In the core session we used the function <code>isoweek()</code> from the <a href="https://lubridate.tidyverse.org">lubridate</a> package to derive the week ISO <em>number</em>. In this session, we need to aggregate data by week, and yet still retain information on dates. To do that we will use the function <code>floor_date()</code>, which also belong to the <a href="https://lubridate.tidyverse.org">lubridate</a> package. This function returns the <em>first date</em> of a given period (day, month, year etc.). You can think of it as a sort of rounding to the smallest value, but for dates.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Predictably, there also is a <code>ceiling_date()</code> function that rounds dates to the highest value of a period</p></div></div><p>The function has a <code>unit =</code> argument that allows you to choose the period of interest (week, month…) and a <code>week_start =</code> period where you can pass the first day of the week (mondays are <code>1</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_linelist</span> <span class="op">&lt;-</span> <span class="va">df_linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="co"># Week number (ISO)</span></span>
<span>    week_outcome <span class="op">=</span> <span class="fu">isoweek</span><span class="op">(</span><span class="va">date_outcome</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># First DATE of the week</span></span>
<span>    week_first_day_outcome <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_outcome</span>,</span>
<span>                                        unit <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>                                        week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at all these time variables:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">date_outcome</span>, <span class="va">week_outcome</span>, <span class="va">week_first_day_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">date_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># Sort the data by date</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id date_outcome week_outcome week_first_day_outcome
1   3   2022-08-19           33             2022-08-15
2   1   2022-08-21           33             2022-08-15
3   2   2022-08-22           34             2022-08-22
4   6   2022-08-25           34             2022-08-22
5  11   2022-09-04           35             2022-08-29
6  12   2022-09-04           35             2022-08-29
7   7   2022-09-04           35             2022-08-29
8  10   2022-09-05           36             2022-09-05
9  15   2022-09-06           36             2022-09-05
10 19   2022-09-09           36             2022-09-05</code></pre>
</div>
</div>
<p>It is even easier to understand if we calculate the day of thee week associated with each date with the function <code>wday()</code> that <em>also</em> belong to the <a href="https://lubridate.tidyverse.org">lubridate</a> package:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;The <a href="https://lubridate.tidyverse.org">lubridate</a> package is an extremely useful tool to manage dates in R…</p></div></div><div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    day_outcome <span class="op">=</span> <span class="fu">wday</span><span class="op">(</span><span class="va">date_outcome</span>, </span>
<span>                       label <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                       abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    day_floor   <span class="op">=</span> <span class="fu">wday</span><span class="op">(</span><span class="va">week_first_day_outcome</span>, </span>
<span>                       label <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                       abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">date_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># Sort the data by date</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date_outcome</span>,</span>
<span>         <span class="va">day_outcome</span>,</span>
<span>         <span class="va">week_outcome</span>,</span>
<span>         <span class="va">week_first_day_outcome</span>,</span>
<span>         <span class="va">day_floor</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   date_outcome day_outcome week_outcome week_first_day_outcome day_floor
1    2022-08-19    vendredi           33             2022-08-15     lundi
2    2022-08-21    dimanche           33             2022-08-15     lundi
3    2022-08-22       lundi           34             2022-08-22     lundi
4    2022-08-25       jeudi           34             2022-08-22     lundi
5    2022-09-04    dimanche           35             2022-08-29     lundi
6    2022-09-04    dimanche           35             2022-08-29     lundi
7    2022-09-04    dimanche           35             2022-08-29     lundi
8    2022-09-05       lundi           36             2022-09-05     lundi
9    2022-09-06       mardi           36             2022-09-05     lundi
10   2022-09-09    vendredi           36             2022-09-05     lundi</code></pre>
</div>
</div>
<p>This illustrate how <code>week_outcome</code> and <code>week_first_day_outcome</code> are two ways to have only one value by week, which makes aggregation possible at the week scale.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> In the import data section of your script, add a new command to your <code>mutate()</code> call and create the variable <code>week_first_day_adm</code> that contains the first day of the week each patient was admitted in. Choose your argument as if the first day of the week is a monday.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Go read the help page for <code>floor_date()</code> to check out the list of possible units.</p>
</div>
</div>
</section><section id="aggregate-by-week" class="level2"><h2 class="anchored" data-anchor-id="aggregate-by-week">Aggregate by week</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Count the number of patients per week of admission, this time using the week start instead of the week number.</p>
</div>
</div>
</div>
<p>Here are the first ten lines of what it should look like:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   week_first_day_adm  n
1          2022-08-15  3
2          2022-08-22  1
3          2022-08-29  4
4          2022-09-05  8
5          2022-09-12 10
6          2022-09-19  3
7          2022-09-26 23
8          2022-10-03 15
9          2022-10-10 18
10         2022-10-17 17</code></pre>
</div>
</div>
</section><section id="draw-the-epicurve" class="level2"><h2 class="anchored" data-anchor-id="draw-the-epicurve">Draw the epicurve</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Create a <code>ggplot</code> with the same look at the epicurve from the <a href="../sessions_core/ggplot.html#sec-epicurve-steps">ggplot core session</a>, but with the first day of the week on the x axis. Don’t forget to update axis names.</p>
</div>
</div>
</div>
<p>It should look like that:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that the bars are identical to the epicurve with weeks number. This is normal, are we are aggregating by week in both cases. It is only the information use to represent the week (ISO number or start date) that changes.</p>
</div>
</div>
</section><section id="improve-the-axis-appearance-breaksand-labels" class="level2"><h2 class="anchored" data-anchor-id="improve-the-axis-appearance-breaksand-labels">Improve the axis appearance (breaksand labels)</h2>
<p><a href="https://ggplot2.tidyverse.org">ggplot2</a> automatically provided labels for the x axis, trying to adjust for the range of data. We can manually force it to make the labels more or less frequent, and we can manually change the format of the labels.</p>
<p>To modify the appearance of the axis, we once again use function from the <a href="../sessions_extra/common_scales.html">scale_ familly</a>: <code>scale_x_date()</code>.</p>
<section id="change-breaks" class="level3"><h3 class="anchored" data-anchor-id="change-breaks">Change breaks</h3>
<p>The breaks controls the frequency of ticks on the axis.</p>
<p>The <code>scale_x_date()</code> function has a <code>date_breaks =</code> argument that accepts the interval between two labels in a string. The string can have the following format: <code>"1 week"</code>, <code>"2 weeks"</code>, <code>"4 months"</code>, <code>"2 years"</code> etc.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Outcome graph</span></span>
<span><span class="va">df_linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">week_first_day_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week_first_day_outcome</span>,</span>
<span>             y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#2E4573"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date of outcome"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Measles cases"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Measles outcomes in Moissala"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"4 months"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Define breaks</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Add the code so that the x-axis displays labels at reasonable intervals on your screen.</p>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section><section id="labels" class="level3"><h3 class="anchored" data-anchor-id="labels">Labels</h3>
<p>Now that we changed the interval between ticks, let’s improve the labels themselves (the way dates are displayed on the axis). By default the labels are in the form “year-month-day”. It is possible to change this. We are going to show you two ways to do that.</p>
<section id="with-the-scales-package." class="level4"><h4 class="anchored" data-anchor-id="with-the-scales-package.">With the <code>{scales}</code> package.</h4>
<p>The <code>scale_x_date()</code> function has a <code>label =</code> argument, that accepts several entries, among which a vector containing the dates, but also a function that generates labels from the breaks. The <a href="https://scales.r-lib.org">scales</a> package has such a function, <code>label_date_short()</code> that attempts to create efficient and short labels for dates (by not repeating the year all the time for example).</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Outcome graph</span></span>
<span><span class="va">df_linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">week_first_day_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week_first_day_outcome</span>,</span>
<span>             y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#2E4573"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date of outcome"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Measles cases"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Measles outcomes in Moissala"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,</span>
<span>               labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Short labels</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Modify you code use <code>label_date_short()</code> to generate labels.</p>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="with-the-strptime-syntax" class="level4"><h4 class="anchored" data-anchor-id="with-the-strptime-syntax">With the <code>strptime</code> syntax</h4>
<p>If you prefer to have full control on how to format dates, R has a syntax to describe date and time formats. There is a long help page with all the syntax items accessible at <code><a href="https://rdrr.io/r/base/strptime.html">help(strptime)</a></code>, but here are a few of the most useful elements to format a date label:</p>
<p><strong>Day</strong>:</p>
<ul>
<li>
<code>%d</code>: from 01 to 31</li>
<li>
<code>%e</code>: from 1 to 31</li>
</ul>
<p><strong>Month</strong>:</p>
<ul>
<li>
<code>%b</code>: abbreviated month name (current locale on your computer)</li>
<li>
<code>%B</code>: full month name (current locale on your computer)</li>
<li>
<code>%m</code>: month as a decimal number</li>
</ul>
<p><strong>Year</strong></p>
<ul>
<li>
<code>%y</code>: Year without the century (two digits)</li>
<li>
<code>%Y</code>: year in four digits</li>
</ul>
<p><strong>Special separators</strong>:</p>
<ul>
<li>
<code>%n</code>: newline</li>
<li>
<code>%t</code>: tab</li>
</ul>
<p>You can assemble these items in a string, that you pass to different functions that accept a format as argument. Here we will pass it to the <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> function to quickly see what display it creates, but after that we will use them in our graph command.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">some_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2024-10-06"</span>, <span class="st">"2024-12-15"</span>, <span class="st">"2025-01-20"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">some_dates</span>, <span class="st">"%Y-%b-%d"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">some_dates</span>, <span class="st">"%Y-%b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">some_dates</span>, <span class="st">"%Y %B %d"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">some_dates</span>, <span class="st">"%y/%m/%d"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">some_dates</span>, <span class="st">"%d/%m/%Y"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Back to the graph, the <code>scale_x_date()</code> function has an argument <code>date_labels =</code> that accept a string of text in the above format for the date labels.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Outcome graph</span></span>
<span><span class="va">df_linelist</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">week_first_day_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week_first_day_outcome</span>,</span>
<span>             y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#2E4573"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date of outcome"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Measles cases"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Measles outcomes in Moissala"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># Define intervals betw. labels</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%Y%n%b%n%d"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Define format of labels</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Code.</strong> Modify the code of you graph to have labels look like this:</p>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="epicurves_dates_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="resources" class="level2"><h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>Chapter of the <a href="https://ggplot2-book.org/scales-position#sec-date-scales">Elegant graphics for sata analyses book</a> on date scales</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>