<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<link rel="alternate" hreflang="en" href="https://epicentre-msf.github.io/repicentre//sessions_extra/shiny_intro.html" />
<link rel="alternate" hreflang="fr" href="https://epicentre-msf.github.io/repicentre//fr/sessions_extra/shiny_intro.fr.html" />
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Learn how to work and customise simple {shiny} apps">

<title>Intoduction to Shiny ‚Äì {repicentre}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-f1aadacce99040138bbb613f9330654f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bd9e9ee71991698ccdf231aaeb59f575.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-04ce264712e6490513e553b82ad07e3b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-bd9e9ee71991698ccdf231aaeb59f575.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/font-awesome-6.7.2/js/script.js"></script>
<script type="text/javascript" src="../script.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">{repicentre}</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../pathway.html"> 
<span class="menu-text">Pathway</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../explore.html"> 
<span class="menu-text">Explore</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#setting-up-your-project" id="toc-setting-up-your-project" class="nav-link" data-scroll-target="#setting-up-your-project">Setting up your project</a>
  <ul class="collapse">
  <li><a href="#folder-structure" id="toc-folder-structure" class="nav-link" data-scroll-target="#folder-structure">Project structure</a></li>
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions">Definitions</a></li>
  </ul></li>
  <li><a href="#exploring-the-project" id="toc-exploring-the-project" class="nav-link" data-scroll-target="#exploring-the-project">Exploring the project</a>
  <ul class="collapse">
  <li><a href="#anatomy-of-a-shiny-app" id="toc-anatomy-of-a-shiny-app" class="nav-link" data-scroll-target="#anatomy-of-a-shiny-app">Anatomy of a Shiny App</a></li>
  <li><a href="#running-your-first-app" id="toc-running-your-first-app" class="nav-link" data-scroll-target="#running-your-first-app">Running Your First App</a></li>
  </ul></li>
  <li><a href="#understanding-the-ui" id="toc-understanding-the-ui" class="nav-link" data-scroll-target="#understanding-the-ui">Understanding the UI</a>
  <ul class="collapse">
  <li><a href="#layout-functions" id="toc-layout-functions" class="nav-link" data-scroll-target="#layout-functions">Layout Functions</a></li>
  <li><a href="#input-functions" id="toc-input-functions" class="nav-link" data-scroll-target="#input-functions">Input Functions</a></li>
  <li><a href="#output-func" id="toc-output-func" class="nav-link" data-scroll-target="#output-func">Output Functions</a></li>
  <li><a href="#adding-a-new-input" id="toc-adding-a-new-input" class="nav-link" data-scroll-target="#adding-a-new-input">Adding a New Input</a></li>
  </ul></li>
  <li><a href="#understanding-the-server" id="toc-understanding-the-server" class="nav-link" data-scroll-target="#understanding-the-server">Understanding the Server</a>
  <ul class="collapse">
  <li><a href="#server-structure" id="toc-server-structure" class="nav-link" data-scroll-target="#server-structure">Server Structure</a></li>
  <li><a href="#reactivity-the-heart-of-shiny" id="toc-reactivity-the-heart-of-shiny" class="nav-link" data-scroll-target="#reactivity-the-heart-of-shiny">Reactivity: The Heart of Shiny</a></li>
  <li><a href="#render-functions" id="toc-render-functions" class="nav-link" data-scroll-target="#render-functions">Render Functions</a></li>
  </ul></li>
  <li><a href="#adding-a-new-output" id="toc-adding-a-new-output" class="nav-link" data-scroll-target="#adding-a-new-output">Adding a new output</a>
  <ul class="collapse">
  <li><a href="#planning-your-next-output" id="toc-planning-your-next-output" class="nav-link" data-scroll-target="#planning-your-next-output">Planning Your Next Output</a></li>
  <li><a href="#the-ui" id="toc-the-ui" class="nav-link" data-scroll-target="#the-ui">The UI</a></li>
  <li><a href="#the-server" id="toc-the-server" class="nav-link" data-scroll-target="#the-server">The server</a></li>
  </ul></li>
  <li><a href="#done" id="toc-done" class="nav-link" data-scroll-target="#done">Done!</a></li>
  <li><a href="#going-further" id="toc-going-further" class="nav-link" data-scroll-target="#going-further">Going Further</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intoduction to Shiny</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Satellite</div>
    <div class="quarto-category">Visualization</div>
    <div class="quarto-category">Dashboard</div>
  </div>
  </div>

<div>
  <div class="description">
    Learn how to work and customise simple {shiny} apps
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Understand the basic structure of a Shiny App</li>
<li>Customise the UI by adding new input</li>
<li>Understand the app server and reactivity</li>
<li>Add a new output to an existing shiny app</li>
</ul>
</section>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>During this session we will be using some specific R packages, please make sure they are installed and loaded</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("shiny")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("bslib")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bslib)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="setting-up-your-project" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-your-project">Setting up your project</h2>
<section id="folder-structure" class="level3">
<h3 class="anchored" data-anchor-id="folder-structure">Project structure</h3>
<div class="setup">
<p>If not done already, download and unzip the course folder. Save the uncompressed folder to a location that is <span class="hovertip" data-bs-toggle="tooltip" data-bs-title="OneDrive doesn't play well with R as it will attempt to constantly synchronize certain project files in a way that can cause errors or memory problems"><strong>not connected to OneDrive</strong></span> and navigate into it.</p>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/raw/main/data/shiny-app-init.zip">
<button class="btn btn-default"><i class="fa fa-save"></i>  Course Folder</button>
</a>
</div>
</div>
</div>
<p>This folder gives an example of a typical, single-file shiny app structure:</p>
<ul>
<li>üìÅ data
<ul>
<li>üìÅ clean
<ul>
<li>üìÑ moissala_data.rds</li>
</ul></li>
</ul></li>
<li>üìÑ app.R</li>
</ul>
<p>It creates a small epidemiological dashboard that analyses simulated data from a measles outbreak in Mo√Øssala, Southern Chad (<code>moissala_data.rds</code>). This folder will be your working directory for <strong>the entire session</strong>.</p>
</section>
<section id="definitions" class="level3">
<h3 class="anchored" data-anchor-id="definitions">Definitions</h3>
<p>In this session we will use interchangeably <em>dashboard</em> and <em>app</em> as both refer to the same interactive web application built with the <code>{shiny}</code> package. <strong>App</strong> is the technical term for any application build with the package, while <strong>dashboard</strong> emphasizes the visual presentation of data and metrics within that app.</p>
</section>
</section>
<section id="exploring-the-project" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-project">Exploring the project</h2>
<p>This project is a very simple shiny app, and we are first going to understand how it is organised.</p>
<div class="look">
<p>Have a look at your project:</p>
<ul>
<li><p>can you see where the data are stored? under which format?</p></li>
<li><p>open the file <code>app.R</code> and explore it</p></li>
</ul>
</div>
<p>As any other project, our app has some data stored internally in <code>data/clean</code> folders, nothing fancy about that. Now the core of it lies in the <code>app.R</code> file.</p>
<section id="anatomy-of-a-shiny-app" class="level3">
<h3 class="anchored" data-anchor-id="anatomy-of-a-shiny-app">Anatomy of a Shiny App</h3>
<p>Every Shiny app has <strong>four essential components</strong>:</p>
<ol type="1">
<li><strong>User Interface (UI)</strong>: defines the layout and appearance of your app</li>
<li><strong>Server</strong>: contains the logic that creates outputs and handles user interactions</li>
<li><strong>Reactivity</strong>: through reactive expressions, this links the user (inputs) with the server logic and the visual outputs</li>
<li><strong>App call</strong>: launches the application</li>
</ol>
<p>In simple apps, these are all bundled into a single file <code>app.R</code>, but they are can be organised in a two-file structure with <code>server.R</code> and <code>ui.R</code> for more complex apps.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/extra/shiny/key-component-shiny-app.png" class="img-fluid figure-img"></p>
<figcaption>Key structure and components of a simple shiny app</figcaption>
</figure>
</div>
<div class="look">
<p>Looking at <code>app.R</code>, can you identify these three components?</p>
<ul>
<li>Where does the UI start and end?</li>
<li>Where does the server logic live?</li>
<li>Can you spot where reactivity may lie ?</li>
<li>What line of code actually runs the app?</li>
</ul>
</div>
<p>The basic structure looks like this:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bslib)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">page_fluid</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># UI elements go here</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Server logic goes here</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Where two objects: <code>ui</code> and <code>server</code> (a function) are defined, and then passed to the <code>shinyApp()</code> function.</p>
</section>
<section id="running-your-first-app" class="level3">
<h3 class="anchored" data-anchor-id="running-your-first-app">Running Your First App</h3>
<div class="write">
<p>Let‚Äôs run the app to see it in action:</p>
<ol type="1">
<li>Open <code>app.R</code></li>
<li>Click the Run App button at the top of the script (or use Cmd/Ctrl + A + Enter)</li>
<li>The app should open in a new window or in the Viewer pane</li>
</ol>
<p>Once the app is running, try interacting with any input controls:</p>
<ul>
<li>Do the outputs update when you change inputs?</li>
<li>Click the Stop button (red square) to close the app when done</li>
</ul>
<p>If the app doesn‚Äôt run, check the R console for error messages</p>
</div>
<p>Now let‚Äôs dig into it and customise it</p>
</section>
</section>
<section id="understanding-the-ui" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-ui">Understanding the UI</h2>
<p>The User Interface (UI) is where we design the appearance and layout of the app, we will define which inputs can user interact with, choose where to put the outputs (plot, tables) of the analyses and organise everything on the screen. It is built using layout, input and ouput functions that nest inside each other.</p>
<p><strong>Why <code>{bslib}</code>?</strong></p>
<p>Modern Shiny apps use the <code>{bslib}</code> package for layouts instead of the older base Shiny functions. <code>{bslib}</code> provides:</p>
<ul>
<li>Modern Bootstrap CSS: Uses the latest Bootstrap framework for better styling and responsive design</li>
<li>Theming capabilities: Easy customization of app appearance with custom themes</li>
<li>Better layouts: More intuitive and flexible layout functions</li>
<li>Recommended by Posit: The Shiny development team recommends <code>{bslib}</code> for all new apps</li>
</ul>
<p>While you may see older Shiny code using functions like <code>fluidPage()</code> and <code>sidebarLayout()</code>, we‚Äôll focus on the modern <code>{bslib}</code> equivalents throughout this tutorial.</p>
<section id="layout-functions" class="level3">
<h3 class="anchored" data-anchor-id="layout-functions">Layout Functions</h3>
<p>Layout functions control how your app is structured visually. The most common <code>{bslib}</code> pattern is:</p>
<ul>
<li><code>page_sidebar()</code>: Creates a page with a built-in sidebar layout:
<ul>
<li>Takes a title argument for the app title</li>
<li>Contains a <code>sidebar()</code> function that defines the sidebar panel (typically for input controls)</li>
<li>Main content (outputs) goes directly in the page, no wrapper needed</li>
</ul></li>
<li><code>page_fluid()</code>: Creates a responsive page without a sidebar</li>
<li><code>page_fillable()</code>: Creates a page that fills the browser height - great for full-screen dashboards</li>
</ul>
<p>Other useful layout functions include <code>layout_columns()</code> and <code>layout_column_wrap()</code> for creating custom grid layouts, and <code>navset_tab()</code> for organizing content into tabs.</p>
</section>
<section id="input-functions" class="level3">
<h3 class="anchored" data-anchor-id="input-functions">Input Functions</h3>
<p>Input functions create interactive controls that users can manipulate. Each input has two key arguments:</p>
<ol type="1">
<li><strong><code>inputId</code></strong>: A unique identifier (string) used to access the value in the server</li>
<li><strong><code>label</code></strong>: Text displayed to the user describing the input</li>
<li><strong>any other arguments</strong>: depending on which input function is called</li>
</ol>
<p>Common input functions include:</p>
<ul>
<li><strong><code>dateRangeInput()</code></strong>: Date range picker with start and end dates</li>
<li><strong><code>selectInput()</code></strong>: Dropdown menu with multiple options</li>
<li><strong><code>numericInput()</code></strong>: Input box for numeric values</li>
<li><strong><code>radioButtons()</code></strong>: Radio buttons for mutually exclusive choices</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>inputId</code> must be unique across your entire app. You‚Äôll reference it in the server function as <code>input$date_range</code>, <code>input$variable</code>, etc.</p>
</div>
</div>
<p>There are a loads of input possibilities, and they can be explored here: <a href="https://shiny.posit.co/r/gallery/widgets/widget-gallery/">Shiny Widget Gallery</a></p>
</section>
<section id="output-func" class="level3">
<h3 class="anchored" data-anchor-id="output-func">Output Functions</h3>
<p>Output functions create placeholders in the UI where results will be displayed. Like inputs, each output has a unique ID, and the main ones are:</p>
<ul>
<li><strong><code>plotOutput()</code></strong>: Placeholder for plots</li>
<li><strong><code>tableOutput()</code></strong>: Placeholder for data tables</li>
</ul>
<p>But these are just placeholders - the actual content is generated in the server function using matching <code>render*()</code> functions. We will deal with this later</p>
<div class="look">
<p>In the <code>app.R</code> file:</p>
<ul>
<li>What is the main layout function being used? (look for a function with <code>layout</code> in the name)</li>
<li>Can you identify the title of the app?</li>
<li>How many input controls are there? What are their <code>inputId</code>s?</li>
<li>How many output placeholders are there? What are their <code>outputId</code>s and types?</li>
<li>Try to trace the connection: for each output in the UI, can you find where it‚Äôs rendered in the server?</li>
</ul>
</div>
<p>Looking at the <code>app.R</code> file, we can identify the key input and output elements that make this app interactive.</p>
<ol type="1">
<li><p>There is one input control: a <code>dateRangeInput()</code> with <code>inputId = "date_range"</code> that allows users to select a start and end date for filtering the data. This input appears in the sidebar panel and is initialized with the minimum and maximum dates from the dataset.</p></li>
<li><p>There is one output placeholder: a <code>plotOutput()</code> with <code>outputId = "epicurve"</code> that displays the epidemic curve in the main panel.</p></li>
<li><p>The connection between the UI and server is established through these IDs in the server function: you‚Äôll see <code>input$date_range</code> being used to access the selected dates, and <code>output$epicurve</code> being assigned with <code>renderPlot()</code> to generate the actual plot. This pairing of <code>dateRangeInput()</code> with <code>renderPlot()</code> demonstrates the fundamental pattern of Shiny: <strong>inputs capture user choices</strong>, <strong>outputs display results</strong>, and the server connects them through <strong>reactive expressions</strong>.</p></li>
</ol>
</section>
<section id="adding-a-new-input" class="level3">
<h3 class="anchored" data-anchor-id="adding-a-new-input">Adding a New Input</h3>
<p>Now that we understand how inputs and outputs work together, let‚Äôs add a new input to customize our epicurve.</p>
<div class="look">
<p>Can you think of a new input that would improve the epicurve? What additional control might users want?</p>
</div>
<p>An epicurve showing daily cases is detailed, but it can be visually overwhelming, especially over long time periods. What if we added an input that allows users to select the level of time aggregation (day/week/month/year)? This would let them zoom in for detailed daily trends or zoom out to see broader patterns.</p>
<p>There are several ways to do this, we will stick to an easy one, and achieve it by creating a select input with <code>selectInput()</code>. This function creates a dropdown menu where users can choose from predefined options. The basic syntax is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">selectInput</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputId =</span> <span class="st">"time_unit"</span>,      <span class="co"># Unique ID to reference in server</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Time Unit:"</span>,        <span class="co"># Label shown to user</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Day"</span>, <span class="st">"Week"</span>, <span class="st">"Month"</span>, <span class="st">"Year"</span>),  <span class="co"># Options in dropdown</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">selected =</span> <span class="st">"Day"</span>             <span class="co"># Default selection</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="write">
<p>Add this <code>selectInput()</code> to the sidebar panel in your UI, right below the <code>dateRangeInput()</code>.</p>
<p>Once this is done, run the app again, what happens when you interact with your new input ?</p>
</div>
<p>Nice you managed to add a new input, but this is not yet active as it is not linked to our data. Now is a good occasion to dive into the server side of things !</p>
</section>
</section>
<section id="understanding-the-server" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-server">Understanding the Server</h2>
<p>The server function is where the <strong>reactive magic</strong> happens. It takes user inputs and creates outputs dynamically based on user interactions.</p>
<section id="server-structure" class="level3">
<h3 class="anchored" data-anchor-id="server-structure">Server Structure</h3>
<p>The server is always defined as a function with three arguments and the following pattern:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Server logic goes here</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create outputs</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>plot1 <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Code to create a plot</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table1 <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Code to create a table</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><strong>input</strong>: A list-like object containing all input values from the UI (accessed as input$inputId)</li>
<li><strong>output</strong>: A list-like object where you assign rendered outputs (accessed as output$outputId)</li>
<li><strong>session</strong>: Contains information about the current Shiny session (advanced usage)</li>
</ul>
<section id="data-management-in-the-server" class="level4">
<h4 class="anchored" data-anchor-id="data-management-in-the-server">Data management in the server</h4>
<p>The core of the server function is where we manipulate data based on user inputs. This is where we:</p>
<ul>
<li>Filter data based on user selections</li>
<li>Transform variables</li>
<li>Calculate statistics</li>
<li>Prepare data for visualization</li>
</ul>
<p>This all happens before we create the visual outputs. Think of it as a pipeline:</p>
<p><em>user inputs</em> ‚Üí <em>data manipulation</em> ‚Üí <em>outputs</em></p>
<p>For example, if a user selects a date range, we need to filter our dataset to only include cases within that range. If they want to change the time aggregation, we need to transform the dates accordingly. The server handles all this logic.</p>
<div class="look">
<p>In the server function of <code>app.R</code>:</p>
<ul>
<li>Can you find where the data is been loaded ? Where is it compared to the server and ui ?</li>
<li>Can you find where data is being filtered?</li>
<li>Which input values are being used in the filtering? (look for <code>input$..</code>.)</li>
<li>Where does the filtering happen relative to creating the plot?</li>
</ul>
</div>
<p>Notice that in <code>app.R</code>, the data is loaded outside the server function (and outside the UI as well). This way, it‚Äôs loaded once when the app starts, not every time a user interacts with it. This is much more efficient than loading data inside the server, which would reload it repeatedly.</p>
<p>Data are then used in the server where they are filtered based on the date range (<code>input$date_range</code>) defined by the user, thus creating a new, filtered dataset: <code>filtered_data</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the data based on user input</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    linelist <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        date_onset <span class="sc">&gt;=</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>], <span class="co"># the lower bound of the date range is accessed here</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        date_onset <span class="sc">&lt;=</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>] <span class="co"># the upper bound of the date range is accessed here</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now meticulous observer will notice that our filtering step is wrapped into a <code>reactive({})</code> call - here is a very important concept, this is what makes this all process interactive !</p>
</section>
</section>
<section id="reactivity-the-heart-of-shiny" class="level3">
<h3 class="anchored" data-anchor-id="reactivity-the-heart-of-shiny">Reactivity: The Heart of Shiny</h3>
<p><strong>Reactivity</strong> is what makes Shiny apps interactive. When a user changes an input, Shiny automatically knows which outputs depend on that input and re-runs only the necessary code.</p>
<p>The basic reactive flow looks like this:</p>
<p><em>User changes input</em> ‚Üí <em>Reactive expression updates</em> ‚Üí <em>Output re-renders</em></p>
<section id="reactive-expressions" class="level4">
<h4 class="anchored" data-anchor-id="reactive-expressions">Reactive Expressions</h4>
<p>In our app.R, we use <code>reactive()</code> to create a filtered version of the data based on the date range selected by the user:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  linelist <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      date_onset <span class="sc">&gt;=</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>], <span class="co"># lower bound of date range</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      date_onset <span class="sc">&lt;=</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>]  <span class="co"># upper bound of date range</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates a reactive expression that:</p>
<ol type="1">
<li>Automatically re-runs when <code>input$date_range</code> changes</li>
<li>Caches its result so it doesn‚Äôt re-compute unnecessarily</li>
<li>Can be used by multiple outputs efficiently</li>
<li>Is called with parentheses: <code>filtered_data()</code> (like a function)</li>
</ol>
<p>With this reactive expression our data management step is automatically linked to all of our user inputs, and can be automatically updated when they change !</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reactive expressions are called with () because they are special functions. Always use <code>filtered_data()</code>, not <code>filtered_data</code>, when you want to access the filtered data.</p>
</div>
</div>
<div class="look">
<p>In the server function:</p>
<ul>
<li>Can you identify the <code>reactive()</code> expressions? How many do you see ?</li>
<li>What input value triggers them to update?</li>
<li>Where is <code>filtered_data()</code> being used? (<em>remember the parentheses!</em>)</li>
<li>What would happen if the user changes the date range?</li>
</ul>
</div>
<p>The beauty of reactivity is that you don‚Äôt need to manually tell Shiny when to update outputs. Shiny automatically tracks dependencies:</p>
<p>when <code>input$date_range</code> changes ‚Üí <code>filtered_data()</code> updates ‚Üí any output using <code>filtered_data()</code> re-renders.</p>
</section>
<section id="implement-our-new-input" class="level4">
<h4 class="anchored" data-anchor-id="implement-our-new-input">Implement our new input</h4>
<p>Remember the <code>selectInput()</code> we added for time aggregation? Now we need to make it functional in the server by modifying our reactive expression. You noticed earlier that we are indeed working with two reactive expression</p>
<ol type="1">
<li><code>filtered_date()</code> which then feeds in</li>
<li><code>plot_df()</code> to create a dataframe used for plotting the epicurve.</li>
</ol>
<div class="look">
<ul>
<li>How are data been processed for plotting ?</li>
<li>Do we need to change anything if we want to aggregate ?</li>
</ul>
</div>
<p>Currently, our epicurve counts cases by exact date using the reactive expression <code>filtered_data()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filtered_data</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date_onset)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>But we want to aggregate by the time unit selected by the user (<code>input$time_unit</code>). So we need to transform <code>date_onset</code> based on the selected time unit before counting, and this can be implemented in our <code>plot_df()</code> reactive expression.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can use <code>floor_date()</code> from the <code>{lubridate}</code> package to round dates to different units. The syntax is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">floor_date</span>(date_column, <span class="at">unit =</span> <span class="st">"week"</span>)  <span class="co"># unit can be "day", "week", "month", "year"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that <code>floor_date()</code> expects lowercase units (‚Äúweek‚Äù, ‚Äúmonth‚Äù), but our <code>selectInput()</code> choices are capitalized (‚ÄúWeek‚Äù, ‚ÄúMonth‚Äù). You‚Äôll need to convert them using <code>tolower()</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that we use <strong>two separate reactive expressions</strong> for data manipulation:</p>
<ol type="1">
<li><strong><code>filtered_data()</code></strong>: Returns the filtered linelist with all individual cases</li>
<li><strong><code>plot_df()</code></strong>: Returns an aggregated count dataframe</li>
</ol>
<p>This separation is intentional. By keeping <code>filtered_data()</code> in its original linelist format (one row per case), we maintain flexibility to add other outputs later (like tables, summary statistics, or additional plots) that might need access to individual case data. The <code>plot_df()</code> reactive then handles the specific aggregation needed for the epicurve visualization.</p>
</div>
</div>
<div class="write">
<p>Modify the <code>plot_df()</code> reactive expression to:</p>
<ol type="1">
<li>Create a new variable that floors <code>date_onset</code> to the selected time unit (use <code>mutate()</code> and <code>floor_date</code>)</li>
<li>Count by this new aggregated date variable instead of <code>date_onset</code></li>
</ol>
<p>Then make necessary changes so that the plotting function use newly aggregated date on the x-axis</p>
</div>
<div class="look">
<p>Once you‚Äôve implemented this, test your app:</p>
<ul>
<li>Change the time unit dropdown - does the epicurve update automatically?</li>
<li>Try ‚ÄúWeek‚Äù - do you see weekly aggregated bars?</li>
<li>Try ‚ÄúMonth‚Äù - does it show monthly counts?</li>
<li>Combine it with the date range filter - does everything work together?</li>
</ul>
</div>
<p>This demonstrates the power of reactivity: you modified the render function to use <code>input$time_unit</code>, and Shiny automatically knows to re-run it when either <code>input$time_unit</code> <strong>OR</strong> <code>input$date_range</code> changes because they are linked through reactive expressions !</p>
</section>
</section>
<section id="render-functions" class="level3">
<h3 class="anchored" data-anchor-id="render-functions">Render Functions</h3>
<p>Now that we understand how data flows through reactive expressions, we need to display it to the user (even though you just made it work !). This is where <strong>render functions</strong> come in.</p>
<p>Render functions are the final step in our reactive pipeline. They take the processed data and create visual outputs (plots, tables, text) that appear in the UI.</p>
<section id="the-render-pattern" class="level4">
<h4 class="anchored" data-anchor-id="the-render-pattern">The Render Pattern</h4>
<p>Each type of output placeholder in the UI (see <a href="#output-func">Output Functions</a>) has a corresponding render function in the server:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>UI Function</th>
<th>Server Function</th>
<th>What it creates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plotOutput()</code></td>
<td><code>renderPlot()</code></td>
<td>Plots and visualizations</td>
</tr>
<tr class="even">
<td><code>tableOutput()</code></td>
<td><code>renderTable()</code></td>
<td>Data tables</td>
</tr>
<tr class="odd">
<td><code>textOutput()</code></td>
<td><code>renderText()</code></td>
<td>Plain text</td>
</tr>
<tr class="even">
<td><code>verbatimTextOutput()</code></td>
<td><code>renderPrint()</code></td>
<td>Console-style output</td>
</tr>
</tbody>
</table>
<p>These are the base Shiny render functions, but many visualization and table packages provide their own specialized render functions. For example, <code>{leaflet}</code> has <code>renderLeaflet()</code> for interactive maps, and <code>{highcharter}</code> has <code>renderHighchart()</code> for interactive charts. These package-specific render functions follow the same pattern but are optimized for their respective output types.</p>
</section>
<section id="how-render-functions-work" class="level4">
<h4 class="anchored" data-anchor-id="how-render-functions-work">How Render Functions Work</h4>
<p>Render functions are <strong>reactive endpoints</strong>. They:</p>
<ol type="1">
<li>Automatically re-execute when their reactive dependencies change</li>
<li>Send the updated output to the UI</li>
<li>Are always assigned to <code>output$</code> with a name that matches an <code>outputId</code> in the UI</li>
</ol>
<p>For example, if we have <code>plotOutput("epicurve")</code> in the UI, we need <code>output$epicurve &lt;- renderPlot({...})</code> in the server.</p>
<div class="look">
<p>In the server function:</p>
<ul>
<li>How many <code>output$...</code> assignments are there?</li>
<li>Do the output names match the <code>outputId</code>s in the UI?</li>
<li>What type of render function is being used?</li>
<li>Can you identify the reactive dependencies? (What inputs or reactive expressions does it use?)</li>
</ul>
</div>
<p>In our app, we have one render function that creates the epicurve:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>epicurve <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_df</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_onset, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Cases by Date of Onset"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Date of Onset"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Number of Cases"</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Notice how this render function depends on <code>plot_df()</code>, which itself depends on <code>filtered_data()</code>. When the user changes the date range <strong>OR</strong> the time units, <code>filtered_data()</code> updates, which updates <code>plot_df()</code>, which automatically triggers <code>renderPlot()</code> to re-run and update the plot in the UI.</p>
<p>Inside a render function, you write normal R code to create your output. For <code>renderPlot()</code>, this is typically <code>{ggplot2}</code> code. For <code>renderTable()</code>, you‚Äôd prepare a dataframe. The key is that the last line of the render function should produce the output you want to display. This</p>
<div class="write">
<p>Inside the render function for our epicurve, can you make the following changes to improve the visualization:</p>
<ol type="1">
<li><p>Change the fill color of the bars to something more appropriate for disease surveillance (hint: try a red tone like <code>"#E74C3C"</code> or <code>"coral"</code>)</p></li>
<li><p>Add a border to the bars using the <code>color</code> argument in <code>geom_col()</code> (try <code>color = "white"</code> to separate bars clearly)</p></li>
</ol>
<p><em>Bonus</em>:</p>
<ol start="3" type="1">
<li><p>Update the plot title to be more informative - include the time unit being displayed (hint: you can use <code>paste()</code> or <code>glue()</code> to combine text with <code>input$time_unit</code>)</p></li>
<li><p>Improve the axis labels:</p>
<ul>
<li>Make the x-axis label dynamic based on the selected time unit</li>
<li>Consider adding units to the y-axis (e.g., ‚ÄúNumber of Cases (n)‚Äù)</li>
</ul></li>
<li><p>Add a subtitle that shows the date range being displayed using <code>subtitle</code> in <code>labs()</code></p></li>
<li><p>Add a caption that says how many cases with valid dates are been displayed</p></li>
</ol>
</div>
<p>The customization possibilities within render functions are as infinite as the customization of plots themselves: there‚Äôs no right or wrong way to style your outputs, only what best communicates your data (except pie charts‚Äîbecause nothing says ‚ÄúI understand data visualization‚Äù quite like a circle divided into 9 differently colored slices that all look identical).</p>
<p>Here is a suggestion:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">renderPlot</span>({</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    n_valid <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">filtered_data</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date_onset)))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_df</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> agg_date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#E74C3C"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Cases by"</span>, input<span class="sc">$</span>time_unit),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">paste</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Date range:"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">format</span>(input<span class="sc">$</span>date_range[<span class="dv">1</span>], <span class="st">"%b %d, %Y"</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">"to"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">format</span>(input<span class="sc">$</span>date_range[<span class="dv">2</span>], <span class="st">"%b %d, %Y"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">paste</span>(<span class="st">"Date of Onset ("</span>, input<span class="sc">$</span>time_unit, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Number of Cases (n)"</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="fu">paste</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Displaying"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>          n_valid,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cases with valid dates"</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that we‚Äôve explored all three components of a Shiny app: the <strong>UI</strong> (defining inputs and output placeholders), <strong>reactive expressions</strong> (managing and filtering data based on user inputs), and <strong>render functions</strong> (creating the actual visualizations), you have all the building blocks needed to add new features.</p>
<p>Let‚Äôs put this knowledge into practice by adding a completely new output to our dashboard!</p>
</section>
</section>
</section>
<section id="adding-a-new-output" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-new-output">Adding a new output</h2>
<p>Now that you‚Äôve built and customized your first Shiny app, let‚Äôs pause and think about dashboard design more broadly. Before we add another output, we should ask ourselves: <strong>what makes a dashboard useful?</strong></p>
<p>A good dashboard isn‚Äôt just about cramming in every possible visualization‚Äîit‚Äôs about <strong>communicating insights effectively</strong> and <strong>enabling decision-making</strong>. Before adding any new element, ask yourself:</p>
<ol type="1">
<li><strong>Purpose</strong>: What question does this output answer? Who is the intended user?</li>
<li><strong>Clarity</strong>: Does this visualization communicate information clearly, or does it add noise?</li>
<li><strong>Actionability</strong>: Can users make decisions or take actions based on what they see?</li>
<li><strong>Context</strong>: Does this output complement existing visualizations or duplicate information?</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Every element should serve a purpose. If you can‚Äôt articulate why something is there, it probably shouldn‚Äôt be.</p>
</div>
</div>
<div class="look">
<p>Think about our current dashboard:</p>
<ul>
<li>Who is it designed for?</li>
<li>What questions can it answer?</li>
<li>What questions <strong>can‚Äôt</strong> it answer that might be important?</li>
<li>If you were responding to this outbreak, what would you want to see next?</li>
</ul>
</div>
<section id="planning-your-next-output" class="level3">
<h3 class="anchored" data-anchor-id="planning-your-next-output">Planning Your Next Output</h3>
<p>Rather than randomly adding features, let‚Äôs be intentional about what we add. Any epidemiologist in the room will tell you that our dashboard currently lacks <strong>Person</strong> and <strong>Place</strong> components to complement the <strong>Time</strong> analysis from the epicurve (which could benefit from much improvement let‚Äôs be honest, but we are short on time). Maps are another level in R, so let‚Äôs stick with something simpler and focus on the <strong>Person</strong> analysis.</p>
<p>For a person analysis in outbreak investigation, we typically want to understand:</p>
<ul>
<li><strong>Age distribution</strong>: Who is being affected? Are certain age groups more vulnerable?</li>
<li><strong>Gender distribution</strong>: Are there gender-specific patterns?</li>
<li><strong>Case demographics</strong>: What are the key characteristics of cases?</li>
</ul>
<p>We‚Äôre going to add a comprehensive person analysis section that includes:</p>
<ol type="1">
<li>An <strong>age pyramid</strong> showing the distribution of cases by age group and gender</li>
<li>A <strong>summary table</strong> displaying key demographic statistics</li>
</ol>
<p>Ok in order to implement these new outputs, we need to deal with two things which you know now:</p>
<ol type="1">
<li>the <strong>UI</strong>: to keep our dashboard organized we‚Äôll use <strong>tabs</strong> to separate the _Summary Statistics from the <em>Age Pyramid</em> plot.</li>
<li>the <strong>server</strong>: We need to code the logic to generate a summary table and an age pyramid.</li>
</ol>
</section>
<section id="the-ui" class="level3">
<h3 class="anchored" data-anchor-id="the-ui">The UI</h3>
<section id="understanding-tabsets" class="level4">
<h4 class="anchored" data-anchor-id="understanding-tabsets">Understanding Tabsets</h4>
<p>Before we start coding, let‚Äôs understand how to organize multiple outputs using tabs. Tabsets allow you to place related visualizations in separate panels that users can switch between, keeping the interface clean and organized.</p>
<p>In <code>{bslib}</code>, you create tabs using:</p>
<ul>
<li><code>navset_tab()</code>: Creates the container for tabs</li>
<li><code>nav_panel()</code>: Defines each individual tab with a title and content</li>
</ul>
<p>The basic structure looks like:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">navset_tab</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nav_panel</span>(<span class="st">"Tab 1 Title"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"plot1"</span>)),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nav_panel</span>(<span class="st">"Tab 2 Title"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"table1"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Each <code>nav_panel()</code> can contain multiple outputs (plots, tables, text).</p>
<div class="write">
<p><strong>Step 1: Restructure the UI with tabsets</strong></p>
<p>Modify your <code>page_sidebar()</code> in the UI to use a tabset structure:</p>
<ol type="1">
<li>Below the epicurve, add a new section with a <code>navset_tab()</code> for the Person Analysis</li>
<li>Create two tabs for the <strong>Person Analysis</strong>:
<ul>
<li>First tab: ‚ÄúAge Pyramid‚Äù containing a placeholder for the age pyramid <code>plotOutput("age_pyramid")</code></li>
<li>Second tab: ‚ÄúSummary Statistics‚Äù containing a placeholder for the table <code>tableOutput("summary_table")</code></li>
</ul></li>
</ol>
<p>Run your app to see the tabbed interface.</p>
<ul>
<li>Does your epicurve still appear at the top?</li>
<li>Do you see the two tabs for Person Analysis below it?</li>
</ul>
</div>
<p>Ok now your <code>page_sidebar()</code> should look like:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inside page_sidebar(), after the epicurve</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotOutput</span>(<span class="st">"epicurve"</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">h3</span>(<span class="st">"Person Analysis"</span>), </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">navset_tab</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nav_panel</span>(<span class="st">"Age Pyramid"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"age_pyramid"</span>)),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nav_panel</span>(<span class="st">"Summary Statistics"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"summary_table"</span>))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let‚Äôs not complicate things further for now and not add anymore inputs - no that our UI is set up we can implement the server logic.</p>
</section>
</section>
<section id="the-server" class="level3">
<h3 class="anchored" data-anchor-id="the-server">The server</h3>
<section id="adding-the-age-pyramid" class="level4">
<h4 class="anchored" data-anchor-id="adding-the-age-pyramid">Adding the Age Pyramid</h4>
<p>An age pyramid is a powerful visualization for understanding the demographic structure of cases. It shows the distribution of cases by age group, split by gender, with males on one side and females on the other. To create an age pyramid, we need to:</p>
<ul>
<li>Count cases by age group and gender (<code>age_group</code> adn `` in the linelist)</li>
<li>Create a horizontal bar chart with males and females on opposite sides</li>
</ul>
<p>To simplify this process, and focuss on the learning of <code>{shiny}</code> concepts, we will use the package <code>{apyramid}</code> to build the Age pyramid plot</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> our_data,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="st">"age_group"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="st">"sex"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="write">
<p><strong>Step 2: Conceptualise the age pyramid</strong></p>
<p>In the server function, thing carefully:</p>
<ul>
<li>What dataset do you want to use for the age pyramid ?</li>
<li>Do you want the dataset to by a reactive expression that responds to user inputs ?</li>
<li>Do you want / need to create a new reactive expression for this plot ?</li>
</ul>
</div>
<p>We want our age pyramid to be influenced by our <code>time_unit</code> and <code>date_range</code> inputs the same way that our epicurve is to make sure they display the same information. Thus, we want to work with the reactive expression <code>filtered_data()</code> to maintain consistency.</p>
<p>Now we need to perform some data manipulation prior to plotting (remove <code>NAs</code>), but these are not dependent on any user inputs, and could be implemented right before plotting. However, to maintain flexibility in our dashboard, and for a future input that could allow the user to interact with the age pyramid (also to practice !), we are going to create another reactive expression called <code>pyramid_df()</code> prior to the plot</p>
<div class="write">
<p><strong>Step 3: Create the age pyramid data</strong></p>
<p>In the server function, after the epicurve render function:</p>
<ul>
<li>Create a reactive expression called <code>pyramid_df</code> that removes <code>NA</code>s for <code>age_group</code> and <code>sex</code></li>
<li>How are you going to access this reactive expression ?</li>
</ul>
<p><strong>Step 4: Call the age pyramid render function</strong></p>
<p>Right after defining <code>pyramid_df()</code>,</p>
<ul>
<li>create a render function to plot the age pyramid</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember, you need to assign the <code>renderPlot()</code> function to an <code>output$</code> of a corresponding ID that you have defined in a placeholder in the UI</p>
</div>
</div>
<ul>
<li>In this render function add the call to <code>apyramid</code> to create the function but be careful with the data you are using !</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this will egenrate an epicurve</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ______,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="st">"age_group"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="st">"sex"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>when you are confident that all is in order, run your app and navigate to the age pyramid tab. Do you see the age pyramid?</p>
<p><em>Bonus</em> You will notice that the <code>sex</code> variable has very simple labels,</p>
<ul>
<li>How and where in the server would you recode these ?</li>
</ul>
</div>
<p>Nice, great to see some more plot up and running, let‚Äôs deal with our final task: adding a demography table to this other tab !</p>
</section>
<section id="adding-a-summary-table" class="level4">
<h4 class="anchored" data-anchor-id="adding-a-summary-table">Adding a summary table</h4>
<p>Here are task is fairly straightforward, we will use our filtered data (via the reactive expression <code>filtered_data()</code>) and <code>summarise()</code> it to display some summary statistics by age group - we will do this directly in the render function <code>renderTable()</code></p>
<div class="write">
<p><strong>Step 5: Create the summary table</strong></p>
<p>In the server function, after the age pyramid render function:</p>
<ul>
<li>add a render function to display the summary table</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember, you need to assign the render function to an output of an ID that you defined in a placeholder in the UI</p>
</div>
</div>
<ul>
<li><p>in this render function make a summary table of <code>filtered_data()</code> wich shows by <code>age_group</code>:</p>
<ul>
<li><code>Total Cases</code></li>
<li><code>Male Cases</code> = sum(gender == ‚Äúm‚Äù, na.rm = TRUE),</li>
<li><code>Female Cases</code> = sum(gender == ‚Äúf‚Äù, na.rm = TRUE),</li>
</ul></li>
</ul>
<p><em>Bonus</em> - Consider adding more useful statistics: - Case fatality ratio (using the <code>outcome</code> data) - Proportion by age group</p>
</div>
<p>This is start to look professional ! Now that you have multiple outputs, you could spend hours making sure that everything looks nice, consistent and cohesive - unfortunately, we will not do this now as we do not have infinity ahead of use.</p>
</section>
</section>
</section>
<section id="done" class="level2">
<h2 class="anchored" data-anchor-id="done">Done!</h2>
<p>And this is a clap, you are done ! Congrats on building and tweaking your first shiny app (if it was) ! I hope you have enjoyed this small practical, and wish you the best of luck in the depth of dashboarding in R. You can find below a link to a solution script for the final App (hosted on github).</p>
<div class="cell">
<div class="cell-output-display">
<a href="https://github.com/epicentre-msf/repicentre/blob/main/sessions_extra/shiny_intro_solutions.R">
<button class="btn btn-default"><i class="fa fa-save"></i> Solution File</button>
</a>
</div>
</div>
</section>
<section id="going-further" class="level2">
<h2 class="anchored" data-anchor-id="going-further">Going Further</h2>
<p>Shiny is a huge field within the R community and there are a lots of amazing resources available online - here is a non-exhaustive list</p>
<ul>
<li>Applied Epi R Handbook Chapter on <a href="https://epirhandbook.com/en/new_pages/rmarkdown.html">Reporting &amp; Dahsboards</a> and <a href="https://epirhandbook.com/en/new_pages/shiny_basics.html">Shiny</a></li>
<li><a href="https://mastering-shiny.org/">Mastering Shiny</a> - the free online reference for anyone working with Shiny</li>
<li>The <a href="https://shiny.posit.co/">Shiny website</a> - full of useful tips and their <a href="https://shiny.posit.co/r/gallery/">Gallery</a> for demos and templates</li>
</ul>
<p><strong>R packages</strong></p>
<ul>
<li><a href="https://epicentre-msf.github.io/epishiny/">{epishiny}</a> - provides simple functions that produce engaging, feature-rich interactive visualisations and dashboards from epidemiological data using R‚Äôs shiny. (developped by <a href="https://epicentre-msf.github.io/gallery/">Epicentre Data Science Team</a>)</li>
<li><a href="https://github.com/dreamRs/shinyWidgets">{shinyWidgets}</a> - gives you many many more widgets that can be used in your app</li>
<li><a href="https://jkunst.com/highcharter/">{highcharter}</a> - R wrapper for the Highcharts (javascript) library for interactive visualisations (license required, potentially paid)</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
